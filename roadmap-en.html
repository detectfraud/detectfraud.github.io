<!-- Collage (3:27 29.08.25) -->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>ĞšĞ°Ğ¼Ñ–Ğ½ÑŒ Ğ»ÑĞ±Ğ¾Ğ²Ñ– â€” Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€</title>
<style>
body { font-family: sans-serif; text-align:center; background:url(https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjghIwEmgtr9VAIzGM4eS8BdLA1nptupwYDch46JvrMH9AILVqnNpUX_vxUtQe2Kr-eNLgXcUu_dfNCc7P45vPblF37xpoN8dbLsm9VHiMKmYf58ixmJeQHTY4R4hvGXj0nC7SqiD_2UWRGvIDgUrvZqoVqq8qT61yJB846igsv4ceY7Q/s1600/fon.png) repeat scroll top left; }
.venwin { border-radius:10px; display:inline-block; background:url(https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjghIwEmgtr9VAIzGM4eS8BdLA1nptupwYDch46JvrMH9AILVqnNpUX_vxUtQe2Kr-eNLgXcUu_dfNCc7P45vPblF37xpoN8dbLsm9VHiMKmYf58ixmJeQHTY4R4hvGXj0nC7SqiD_2UWRGvIDgUrvZqoVqq8qT61yJB846igsv4ceY7Q/s1600/fon.png) repeat scroll top left; }
canvas { border:3px solid #bbb; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,.1); display:block; margin:10px auto; }
#scaleSlider { width:420px;}
button { padding:8px 12px; cursor:pointer; border-radius:8px; }
.disabled { pointer-events:none; opacity:.5; filter:grayscale(100%); }

.gallery-container { display:flex; align-items:flex-start; justify-content:center; gap:10px; margin-top:20px; }
.gallery-block { display:flex; flex-direction:column; align-items:center; gap:10px; }
.gallery-block > div { display:flex; align-items:center; justify-content:center; }
.arrow, .arow { font-size:20px; cursor:pointer; user-select:none; padding:3px; line-height:1; display:flex; align-items:center; justify-content:center; }
.arrow:first-child { margin-right:-110px; } .arrow:last-child { margin-left:-110px; }
.arow:first-child { margin-right:-60px; }
.arow:last-child { margin-left:-60px; }
.thumbnails { display:flex; gap:10px; overflow:hidden; width:600px; justify-content:center; }
.thumb-wrapper { position:relative; }
.thumb { width:108px; height:72px; object-fit:cover; border-radius:8px; cursor:pointer; box-shadow:0 0 6px rgba(0,0,0,0.3); transition:all 0.3s ease; z-index:1; }
.collage { position:relative; display:inline-block; margin-top:40px; }

/* Ğ—Ğ¼Ñ–Ğ½Ğ¸ Ğ² ÑÑ‚Ğ¸Ğ»ÑÑ… Ğ´Ğ»Ñ Ğ³Ğ°Ğ»ĞµÑ€ĞµÑ— ĞºĞ»ÑÑ‚Ğ²: Ñ‚ĞµĞ¿ĞµÑ€ Ğ²Ğ¾Ğ½Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ğ¾Ğ½ÑƒÑ”Ñ‚ÑŒÑÑ Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ¾ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… ĞºĞ°Ğ½Ğ²Ğ°ÑÑƒ,
   Ğ° Ğ·Ğ°Ğ»Ğ¸ÑˆĞ°Ñ”Ñ‚ÑŒÑÑ Ğ² Ğ¿Ğ¾Ñ‚Ğ¾Ñ†Ñ–, ÑĞº Ñ–Ğ½ÑˆÑ– Ğ³Ğ°Ğ»ĞµÑ€ĞµÑ—, Ğ¾ÑĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ ĞºĞ»ÑÑ‚Ğ²Ğ¸ Ğ¼Ğ°Ğ»ÑÑ”Ñ‚ÑŒÑÑ Ğ½Ğ° Canvas. */
.gallery-container.vows .labels { display:grid; grid-template-columns:repeat(4,1fr); text-align:center; margin-bottom:5px; }
.gallery-container.vows .labels .label1 { grid-column:1; font-weight:bold; margin-left:70px; }
.gallery-container.vows .labels .label2 { grid-column:3; font-weight:bold; }

#fot { display:inline-block; cursor:pointer; border-radius:8px; width:108px; height:72px; background-image:url(https://detectfraud.github.io/gallery/Para.png); background-repeat:no-repeat; background-size:contain; }
#fot:hover { mix-blend-mode:luminosity; }
#fot:active { mix-blend-mode:exclusion; }

.imagbox { position:fixed; top:50%; left:50%; width:825px; height:510px; transform:translate(-50%,-50%) scale(0.1); opacity:0; transition:all 0.5s ease; z-index:9999; border-radius:12px; box-shadow:0 0 25px rgba(0,0,0,0.7); pointer-events:none; background:#fff; }
.thumb-wrapper:hover .imagbox { opacity:1; transform:translate(-50%,-50%) scale(0.6); }
.photo-block { margin-left:100px; }
#updateBtn { margin-left:300px;font-weight:bold;color:red; }

.arrow, .arow { position:relative; z-index:3; }
</style>
</head>
<body>

<fieldset class="venwin" style="height:auto;">
<div class="collage" id="collage">
Â  <canvas id="canvas" width="900" height="600" style="border:1px solid #ccc;"></canvas>
</div>

<br><input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1">

<div class="gallery-container">
Â  <div class="gallery-block" id="vowsi">
Â  Â  <b>Ğ¤Ğ¾Ğ½</b>
Â  Â  <div>
Â  Â  Â  <span class="arrow" onclick="prevSlide()">&#10094;</span>
Â  Â  Â  <div class="thumbnails" id="thumbs"></div>
Â  Â  Â  <span class="arrow" onclick="nextSlide()">&#10095;</span>
Â  Â  </div>
Â  </div>
<div class="gallery-block photo-block">
Â  Â  <b>Ğ¤Ğ¾Ñ‚Ğ¾</b>
Â  Â  <div>
Â  Â  <label id="fot" title="Ğ¤Ğ¾Ñ‚Ğ¾ Ğ·Ğ°ĞºĞ¾Ñ…Ğ°Ğ½Ğ¸Ñ…"></label>
Â  </div>
</div>
</div>

<div class="gallery-container vows" id="vowse">
Â  <div class="gallery-block">
Â  Â  <div class="labels">
Â  Â  Â  <span class="label1">ĞĞ°Ğ´Ğ¿Ğ¸Ñ</span>
Â  Â  Â  <span class="label2">ĞšĞ»ÑÑ‚Ğ²Ğ° Ğ·Ğ°ĞºĞ¾Ñ…Ğ°Ğ½Ğ¸Ñ…</span>
Â  Â  </div>
Â  Â  <div class="gallery-row">
Â  Â  Â  <span class="arow" onclick="prevVow()">&#10094;</span>
Â  Â  Â  <div class="thumbnails" id="thumbsVows"></div>
Â  Â  Â  <span class="arow" onclick="nextVow()">&#10095;</span>
Â  Â  </div>
Â  </div>
</div>
<br><br>
Â  <div>
<button id="undoBtn" type="button">âŸ² Undo</button>
<button id="previewBtn" type="button">ğŸ‘ ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´</button>
<button id="downloadBtn" type="button" style="display:none;">ğŸ“¥ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸</button>

Â  <button id="updateBtn" type="button">UPDATE</button>
</div> </fieldset>
<input type="file" id="bgLoader" style="display:none">
<input type="file" id="loveLoader" style="display:none">
<script>
/* === Collage JS === */

// 1. ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ğ¼Ğ¾ Ğ²ÑÑ– Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ñ– DOM-ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¸ Ğ· HTML
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');
const thumbsVows = document.getElementById('thumbsVows');
const loveLoader = document.getElementById('loveLoader');
const scaleSlider = document.getElementById('scaleSlider');
const undoBtn = document.getElementById('undoBtn');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const bgLoader = document.getElementById('bgLoader');
const collage = document.getElementById('collage');
const vowse = document.getElementById('vowse'); // Ğ—Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾: vowse Ñ‚ĞµĞ¿ĞµÑ€ Ğ½Ğµ Ñ…Ğ¾Ğ²Ğ°Ñ”Ñ‚ÑŒÑÑ, Ğ° Ñ” Ğ² Ğ¿Ğ¾Ñ‚Ğ¾Ñ†Ñ–
const vowsi = document.getElementById('vowsi');
const photoBlock = document.querySelector('.photo-block');


/* === Ğ“Ğ°Ğ»ĞµÑ€ĞµÑ Ñ„Ğ¾Ğ½Ñ–Ğ² === */
const url = "https://detectfraud.github.io/gallery/";
const images = [ "nature(1)","nature(2)","nature(3)","nature(4)","nature(5)",
Â  "nature(6)","nature(7)","nature(8)","nature(9)","Fon" ];
const fullImages = images.map(name => url + name + ".jpeg");
let startIndex = 0;

function renderThumbnails() {
    thumbs.innerHTML = "";
    fullImages.slice(startIndex, startIndex + 3).forEach(src => createThumb(src, thumbs, 'bg'));
}

function createThumb(src, container, key) {
    const wrapper = document.createElement("div");
    wrapper.className = "thumb-wrapper";

    const imgName = src.split("/").pop().split(".")[0];

    const thumb = document.createElement("img");
    thumb.className = "thumb";
    thumb.src = src;

    const big = document.createElement("img");
    big.className = "imagbox";
    big.src = src;

    if (imgName === "Fon") {
        thumb.title = "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ ÑĞ²Ñ–Ğ¹ Ñ„Ğ¾Ğ½";
        thumb.onclick = () => bgLoader.click();
    } else {
        thumb.onclick = () => handleFileFromGallery(src, key);
    }

    wrapper.appendChild(thumb);
    wrapper.appendChild(big);
    container.appendChild(wrapper);
}

function prevSlide(){
Â  startIndex=(startIndex-3+fullImages.length)%fullImages.length;
Â  renderThumbnails();
}
function nextSlide(){
Â  startIndex=(startIndex+3)%fullImages.length;
Â  renderThumbnails();
}

/* === Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ· Ğ³Ğ°Ğ»ĞµÑ€ĞµÑ— Ğ½Ğ° Canvas === */
function handleFileFromGallery(src, key){
Â  const img=new Image();
Â  img.crossOrigin="anonymous";
Â  img.onload=()=>{
Â  Â  layers[key].img=img;
Â  Â  layers[key].src=src;

Â  Â  // Ğ’ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ²Ğ¾Ñ— Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ñ— Ñ‚Ğ° Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ñƒ Ğ´Ğ»Ñ ÑˆĞ°Ñ€Ñƒ 'vow'
Â  Â  if (key === 'vow') {
Â  Â  Â  layers[key].scale = 0.5; // Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€ 50%
Â  Â  Â  // Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ‰ĞµĞ½Ğ½Ñ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ¼Ñƒ Ğ½Ğ¸Ğ¶Ğ½ÑŒĞ¾Ğ¼Ñƒ ĞºÑƒÑ‚Ñ–
Â  Â  Â  layers[key].x = canvas.width - (img.width * layers[key].scale / 2) - 10; // 10px Ğ²Ñ–Ğ´ Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ñ
Â  Â  Â  layers[key].y = canvas.height - (img.height * layers[key].scale / 2) - 10; // 10px Ğ²Ñ–Ğ´ Ğ½Ğ¸Ğ¶Ğ½ÑŒĞ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ñ
Â  Â  } else {
Â  Â  Â  layers[key].x=canvas.width/2;
Â  Â  Â  layers[key].y=canvas.height/2;
Â  Â  Â  layers[key].scale=1;
Â  Â  }
Â  Â  activeLayer=key; // Ğ—Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾: activeLayer Ñ‚ĞµĞ¿ĞµÑ€ Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ÑÑ”Ñ‚ÑŒÑÑ ĞºĞ¾Ñ€ĞµĞºÑ‚Ğ½Ğ¾
Â  Â  scaleSlider.value=layers[key].scale; // ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ğ²Ğ·ÑƒĞ½ĞºĞ°
Â  Â  pushHistory();
Â  Â  drawAll();
Â  };
Â  img.src=src;
}

/* === Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ„Ğ¾Ñ‚Ğ¾/Ñ„Ğ¾Ğ½Ñ–Ğ² Ğ· Ñ„Ğ°Ğ¹Ğ»Ñƒ === */
function handleFileLoad(file,key){
Â  if(!file) return;
Â  const reader=new FileReader();
Â  reader.onload=e=>{
Â  Â  const data=e.target.result;
Â  Â  const img=new Image();
Â  Â  img.onload=()=>{
Â  Â  Â  layers[key].img=img;
Â  Â  Â  layers[key].src=data;

Â  Â  Â  // Ğ’ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ²Ğ¾Ñ— Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ñ— Ñ‚Ğ° Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ñƒ Ğ´Ğ»Ñ ÑˆĞ°Ñ€Ñƒ 'vow'
Â  Â  Â  if (key === 'vow') {
Â  Â  Â  Â  layers[key].scale = 0.5; // Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€ 50%
Â  Â  Â  Â  // Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ‰ĞµĞ½Ğ½Ñ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ¼Ñƒ Ğ½Ğ¸Ğ¶Ğ½ÑŒĞ¾Ğ¼Ñƒ ĞºÑƒÑ‚Ñ–
Â  Â  Â  Â  layers[key].x = canvas.width - (img.width * layers[key].scale / 2) - 10; // 10px Ğ²Ñ–Ğ´ Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ñ
Â  Â  Â  Â  layers[key].y = canvas.height - (img.height * layers[key].scale / 2) - 10; // 10px Ğ²Ñ–Ğ´ Ğ½Ğ¸Ğ¶Ğ½ÑŒĞ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ñ
Â  Â  Â  } else {
Â  Â  Â  Â  layers[key].x=canvas.width/2;
Â  Â  Â  Â  layers[key].y=canvas.height/2;
Â  Â  Â  Â  layers[key].scale=1;
Â  Â  Â  }
Â  Â  Â  activeLayer=key; // Ğ—Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾: activeLayer Ñ‚ĞµĞ¿ĞµÑ€ Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ÑÑ”Ñ‚ÑŒÑÑ ĞºĞ¾Ñ€ĞµĞºÑ‚Ğ½Ğ¾
Â  Â  Â  scaleSlider.value=layers[key].scale; // ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ğ²Ğ·ÑƒĞ½ĞºĞ°
Â  Â  Â  pushHistory();
Â  Â  Â  drawAll();
Â  Â  };
Â  Â  img.src=data;
Â  };
Â  reader.readAsDataURL(file);
}

bgLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'bg'));
loveLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'love'));
document.getElementById("fot").onclick=()=>loveLoader.click();

renderThumbnails();


/* === Ğ“Ğ°Ğ»ĞµÑ€ĞµÑ ĞºĞ»ÑÑ‚Ğ² === */
const vows=["LoveStones","Eternity","Fidelity","Joy","LoveStones","Love","Strength","Tenderness","LoveStones","Trust","Unity","Heart"];
const fullVows=vows.map(name=>url+name+".png");
let vowIndex=0;

function renderVows() {
    thumbsVows.innerHTML = "";
    fullVows.slice(vowIndex, vowIndex + 4).forEach(src => createThumb(src, thumbsVows, 'vow'));
}
function prevVow(){ vowIndex=(vowIndex-4+fullVows.length)%fullVows.length; renderVows(); }
function nextVow(){ vowIndex=(vowIndex+4)%fullVows.length; renderVows(); }


/* === Ğ¨Ğ°Ñ€Ğ¸ Ñ– Ğ¼Ğ°ÑĞºĞ° (ĞºÑ€ÑƒĞ³Ğ»Ğ° Ğ´Ñ–Ñ€Ğ° Ğ´Ğ»Ñ Ñ„Ğ¾Ñ‚Ğ¾) === */
const template=new Image(); template.src='images/composit.png'; // ĞŸĞµÑ€ĞµĞºĞ¾Ğ½Ğ°Ğ¹Ñ‚ĞµÑÑ, Ñ‰Ğ¾ ÑˆĞ»ÑÑ… Ğ´Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñƒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¸Ğ¹!
const HOLE_OFFSET_X=6, HOLE_OFFSET_Y=-115, HOLE_RADIUS=98;
let mask={cx:canvas.width/2+HOLE_OFFSET_X, cy:canvas.height/2+HOLE_OFFSET_Y, r:HOLE_RADIUS};

// ĞĞ¿Ğ¸Ñ ÑˆĞ°Ñ€Ñ–Ğ²
let layers={
    bg:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
    love:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
    vow:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1}
};

let activeLayer=null, previewMode=false, bgHoleActive=true;

// Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ´Ğ»Ñ Undo
const history=[]; const MAX_HISTORY=20;
function makeSnapshot(){ return { bg:{...layers.bg}, love:{...layers.love}, vow:{...layers.vow}, previewMode, activeLayer, bgHoleActive }; }
function pushHistory(){ history.push(makeSnapshot()); if(history.length>MAX_HISTORY) history.shift(); }
function applySnapshot(s){
Â  previewMode=!!s.previewMode; activeLayer=s.activeLayer||null; bgHoleActive=!!s.bgHoleActive;
Â  ['bg','love','vow'].forEach(key=>{
Â  Â  const v=s[key];
Â  Â  if(v && v.src){
Â  Â  Â  const img=new Image();
Â  Â  Â  img.onload=()=>{ layers[key].img=img; layers[key].src=v.src; layers[key].x=v.x; layers[key].y=v.y; layers[key].scale=v.scale; drawAll(); };
Â  Â  Â  img.src=v.src;
Â  Â  } else {
Â  Â  Â  layers[key].img=null; layers[key].src=null;
Â  Â  Â  layers[key].x=v? v.x: canvas.width/2;
Â  Â  Â  layers[key].y=v? v.y: canvas.height/2;
Â  Â  Â  layers[key].scale=v? v.scale:1;
Â  Â  }
Â  });
Â  toggleButtons();
}


/* === ĞœĞ°Ğ»ÑĞ²Ğ°Ğ½Ğ½Ñ === */
function drawLayerTo(ctxTarget, layer){
Â  if(!layer||!layer.img) return;
Â  const w=layer.img.width*layer.scale,h=layer.img.height*layer.scale;
Â  ctxTarget.drawImage(layer.img, layer.x-w/2, layer.y-h/2, w, h);
}

function drawLove(ctxTarget, clip=false){
Â  const L=layers.love;
Â  if(!L||!L.img) return;
Â  const w=L.img.width*L.scale,h=L.img.height*L.scale;
Â  ctxTarget.save();
Â  if(clip&&mask.r>0){ ctxTarget.beginPath(); ctxTarget.arc(mask.cx,mask.cy,mask.r,0,Math.PI*2); ctxTarget.clip(); }
Â  ctxTarget.drawImage(L.img,L.x-w/2,L.y-h/2,w,h);
Â  ctxTarget.restore();
}

function drawBgWithHole(ctxTarget){
Â  if(!layers.bg.img) return;
Â  if(!bgHoleActive||mask.r<=0){ drawLayerTo(ctxTarget,layers.bg); return; }
Â  const off=document.createElement('canvas');
Â  off.width=canvas.width; off.height=canvas.height;
Â  const octx=off.getContext('2d');
Â  drawLayerTo(octx,layers.bg);
Â  octx.globalCompositeOperation='destination-out';
Â  octx.beginPath(); octx.arc(mask.cx,mask.cy,mask.r,0,Math.PI*2);
Â  octx.fill();
Â  octx.globalCompositeOperation='source-over';
Â  ctxTarget.drawImage(off,0,0);
}

function drawAll(){
Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  drawBgWithHole(ctx);
Â  Â  drawLove(ctx, previewMode);

Â  Â  if(template.complete) {
Â  Â  Â  Â  ctx.drawImage(template, 0, 0, canvas.width, canvas.height);
Â  Â  }
Â  Â  drawLayerTo(ctx, layers.vow); // Ğ—Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾: Ğ¼Ğ°Ğ»ÑÑ”Ğ¼Ğ¾ vow Ğ¿Ñ–ÑĞ»Ñ template, Ñ‰Ğ¾Ğ± Ğ²Ğ¾Ğ½Ğ° Ğ±ÑƒĞ»Ğ° Ğ·Ğ²ĞµÑ€Ñ…Ñƒ
}


/* === ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ¼Ğ¸ĞºĞ°Ğ½Ğ½Ñ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ–Ğ² === */
function toggleButtons(){
Â  if(previewMode){
Â  Â  previewBtn.style.display = 'none';
Â  Â  downloadBtn.style.display = 'inline-block';
Â  Â  if (vowsi) vowsi.style.display = 'none';
Â  Â  if (photoBlock) photoBlock.style.display = 'none';
Â  Â  if (vowse) vowse.style.display = 'none'; // Ğ“Ğ°Ğ»ĞµÑ€ĞµÑ ĞºĞ»ÑÑ‚Ğ² Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ– Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ
Â  Â  setDisabled(true);
Â  } else {
Â  Â  previewBtn.style.display = 'inline-block';
Â  Â  downloadBtn.style.display = 'none';
Â  Â  if (vowsi) vowsi.style.display = 'inline-block';
Â  Â  if (photoBlock) photoBlock.style.display = 'inline-block';
Â  Â  if (vowse) vowse.style.display = 'inline-block'; // Ğ“Ğ°Ğ»ĞµÑ€ĞµÑ ĞºĞ»ÑÑ‚Ğ² Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ° Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ– Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ
Â  Â  setDisabled(false);
Â  }
}


/* === ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±ÑƒĞ²Ğ°Ğ½Ğ½Ñ === */
scaleSlider.addEventListener('input',()=>{
Â  if(!activeLayer) return;
Â  layers[activeLayer].scale=parseFloat(scaleSlider.value);
Â  drawAll();
});


/* === Drag & Touch (Ğ¿ĞµÑ€ĞµĞ¼Ñ–Ñ‰ĞµĞ½Ğ½Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ¾Ğº) === */
let dragging=false, dragStartX=0, dragStartY=0;

canvas.addEventListener('mousedown',e=>{
Â  if(previewMode||!activeLayer) return;
Â  dragging=true;
Â  dragStartX=e.offsetX-layers[activeLayer].x;
Â  dragStartY=e.offsetY-layers[activeLayer].y;
});

canvas.addEventListener('mousemove',e=>{
Â  if(previewMode||!dragging||!activeLayer) return;
Â  layers[activeLayer].x=e.offsetX-dragStartX;
Â  layers[activeLayer].y=e.offsetY-dragStartY;
Â  drawAll();
});

function stopDrag(){
Â  if(previewMode) return;
Â  if(dragging){ dragging=false; pushHistory(); }
}
canvas.addEventListener('mouseup',stopDrag);
canvas.addEventListener('mouseleave',stopDrag);

canvas.addEventListener('touchstart',e=>{
Â  if(previewMode||!activeLayer) return;
Â  const t=e.touches[0],rect=canvas.getBoundingClientRect();
Â  dragging=true;
Â  dragStartX=t.clientX-rect.left-layers[activeLayer].x;
Â  dragStartY=t.clientY-rect.top-layers[activeLayer].y;
Â  e.preventDefault();
});
canvas.addEventListener('touchmove',e=>{
Â  if(previewMode||!dragging||!activeLayer) return;
Â  const t=e.touches[0],rect=canvas.getBoundingClientRect();
Â  layers[activeLayer].x=t.clientX-rect.left-dragStartX;
Â  layers[activeLayer].y=t.clientY-rect.top-dragStartY;
Â  drawAll();
Â  e.preventDefault();
});
canvas.addEventListener('touchend',stopDrag);


/* === Undo / Preview / Download === */
undoBtn.addEventListener('click',()=>{
Â  if(history.length<=1) return;
Â  history.pop();
Â  applySnapshot(history[history.length-1]);
});
previewBtn.addEventListener('click',()=>{
Â  previewMode=true;
Â  pushHistory();
Â  toggleButtons();
Â  drawAll();
});
downloadBtn.addEventListener('click',()=>{
Â  const link=document.createElement('a');
Â  link.download='composition.png';
Â  link.href=canvas.toDataURL('image/png');
Â  link.click();
});

template.onload=()=>{ drawAll(); };

renderThumbnails();
renderVows();
applySnapshot(history[0]||makeSnapshot());


function setDisabled(state){
Â  [thumbs, loveLoader].forEach(el=>{
Â  Â  if (el) {
Â  Â  Â  el.disabled=!!state;
Â  Â  Â  el.classList.toggle('disabled',!!state);
Â  Â  }
Â  });
}

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ addOverlay Ğ±ÑƒĞ»Ğ° Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ°, Ğ¾ÑĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ²Ğ¾Ğ½Ğ° Ğ±Ñ–Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ñ– Ğ²Ğ¸ĞºĞ¾Ğ½ÑƒĞ²Ğ°Ğ»Ğ° Ğ½ĞµĞºĞ¾Ñ€ĞµĞºÑ‚Ğ½Ñƒ Ğ´Ñ–Ñ.

document.getElementById('updateBtn').addEventListener('click', function () {
Â  Â  const url = window.location.href.split('?')[0];
Â  Â  window.location.href = url + '?_=' + new Date().getTime();
});
</script>
</body>
</html>
