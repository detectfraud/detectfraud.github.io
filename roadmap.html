<!-- Collage (21:18 27.08.25) -->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>–ö–∞–º—ñ–Ω—å –ª—é–±–æ–≤—ñ ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<style>
body { font-family: sans-serif; text-align:center; background:url(https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjghIwEmgtr9VAIzGM4eS8BdLA1nptupwYDch46JvrMH9AILVqnNpUX_vxUtQe2Kr-eNLgXcUu_dfNCc7P45vPblF37xpoN8dbLsm9VHiMKmYf58ixmJeQHTY4R4hvGXj0nC7SqiD_2UWRGvIDgUrvZqoVqq8qT61yJB846igsv4ceY7Q/s1600/fon.png) repeat scroll top left; }  /*background:#f5f5f5;*/
.venwin {  border-radius:10px;  display:inline-block; background:url(https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjghIwEmgtr9VAIzGM4eS8BdLA1nptupwYDch46JvrMH9AILVqnNpUX_vxUtQe2Kr-eNLgXcUu_dfNCc7P45vPblF37xpoN8dbLsm9VHiMKmYf58ixmJeQHTY4R4hvGXj0nC7SqiD_2UWRGvIDgUrvZqoVqq8qT61yJB846igsv4ceY7Q/s1600/fon.png) repeat scroll top left; }   /*padding:10px;*/
canvas { border:3px solid #bbb; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,.1); display:block; margin:10px auto; }
#scaleSlider { width:420px;}
button { padding:8px 12px; cursor:pointer; border-radius:8px; }
.disabled { pointer-events:none; opacity:.5; filter:grayscale(100%); }

.gallery-container { display:flex; align-items:flex-start; justify-content:center; gap:10px; margin-top:20px; }
.gallery-block { display:flex; flex-direction:column; align-items:center; gap:10px; }
.gallery-block > div { display:flex; align-items:center; justify-content:center; }
.arrow, .arow { font-size:20px; cursor:pointer; user-select:none; padding:3px; line-height:1; display:flex; align-items:center; justify-content:center;  }
.arrow:first-child { margin-right:-110px; } .arrow:last-child { margin-left:-110px; }
.arow:first-child { margin-right:-60px; }
.arow:last-child { margin-left:-60px; }
.thumbnails { display:flex; gap:10px; overflow:hidden; width:600px; justify-content:center; }
.thumb-wrapper { position:relative; }
.thumb { width:108px; height:72px; object-fit:cover; border-radius:8px; cursor:pointer; box-shadow:0 0 6px rgba(0,0,0,0.3); transition:all 0.3s ease; z-index:1; }
.collage { position:relative; display:inline-block; margin-top:40px; }
.collage img.overlay { position:absolute; bottom:10px; right:10px; width:500px; border-radius:8px; box-shadow:0 0 8px rgba(0,0,0,0.4); }

#fot { display:inline-block; cursor:pointer; border-radius:8px; width:108px; height:72px; background-image:url(https://detectfraud.github.io/gallery/Para.png); background-repeat:no-repeat; background-size:contain; }
#fot:hover { mix-blend-mode:luminosity; }
#fot:active { mix-blend-mode:exclusion; }

.imagbox { position:fixed; top:50%; left:50%; width:825px; height:510px; transform:translate(-50%,-50%) scale(0.1); opacity:0; transition:all 0.5s ease; z-index:9999; border-radius:12px; box-shadow:0 0 25px rgba(0,0,0,0.7); pointer-events:none; background:#fff; }
.thumb-wrapper:hover .imagbox { opacity:1; transform:translate(-50%,-50%) scale(0.6); }
.photo-block { margin-left:100px; }
#updateBtn { margin-left:300px;font-weight:bold;color:red; }
.gallery-container.vows .labels { display:grid; grid-template-columns:repeat(4,1fr); text-align:center; margin-bottom:5px; }
.gallery-container.vows .labels .label1 { grid-column:1; font-weight:bold; margin-left:70px; }
.gallery-container.vows .labels .label2 { grid-column:3; font-weight:bold; }
.arrow, .arow {  position:relative; z-index:3; } /*<br><br>*/
</style>
</head>
<body>

<fieldset class="venwin" style="height:auto;">
<div class="collage" id="collage">
  <canvas id="canvas" width="900" height="600" style="border:1px solid #ccc;"></canvas>
</div>

<br><input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1">

<!-- –ì–∞–ª–µ—Ä–µ—è —Ñ–æ–Ω—ñ–≤ -->
<div class="gallery-container">
  <div class="gallery-block" id="vowsi">
    <b>–§–æ–Ω</b>
    <div>
      <span class="arrow" onclick="prevSlide()">&#10094;</span>
      <div class="thumbnails" id="thumbs"></div>
      <span class="arrow" onclick="nextSlide()">&#10095;</span>
    </div>
  </div>
<div class="gallery-block photo-block"> 
    <b>–§–æ—Ç–æ</b>
    <div>
    <label id="fot" title="–§–æ—Ç–æ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö"></label>
  </div>
</div>
</div>

<!-- –ì–∞–ª–µ—Ä–µ—è –∫–ª—è—Ç–≤ -->
<div class="gallery-container vows" id="vowse" style="display:none;">
  <div class="gallery-block">
    <div class="labels">
      <span class="label1">–ù–∞–¥–ø–∏—Å</span>
      <span class="label2">–ö–ª—è—Ç–≤–∞ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö</span>
    </div>
    <div class="gallery-row">
      <span class="arow" onclick="prevVow()">&#10094;</span>
      <div class="thumbnails" id="thumbsVows"></div>
      <span class="arow" onclick="nextVow()">&#10095;</span>
    </div>
  </div>
</div>
<br><br>
  <div>
<button id="undoBtn" type="button">‚ü≤ Undo</button>
<button id="previewBtn" type="button">üëÅ –ü–µ—Ä–µ–≥–ª—è–¥</button>
<button id="downloadBtn" type="button" style="display:none;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
     
  <button id="updateBtn" type="button">UPDATE</button>
</div> </fieldset>
<input type="file" id="bgLoader" style="display:none">
<input type="file" id="loveLoader" style="display:none">
<script>
/* === Collage JS === */

// 1. –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ DOM-–µ–ª–µ–º–µ–Ω—Ç–∏ –∑ HTML
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');¬† ¬† ¬† ¬† // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥–∞–ª–µ—Ä–µ—ó —Ñ–æ–Ω—ñ–≤
const thumbsVows = document.getElementById('thumbsVows'); // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥–∞–ª–µ—Ä–µ—ó –∫–ª—è—Ç–≤
const loveLoader = document.getElementById('loveLoader'); // –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á —Ñ–æ—Ç–æ (–∫–ª—è—Ç–≤–∏/–¥–µ–∫–æ—Ä)
const scaleSlider = document.getElementById('scaleSlider'); // –ø–æ–≤–∑—É–Ω–æ–∫ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
const undoBtn = document.getElementById('undoBtn');¬† ¬† ¬† ¬†// –∫–Ω–æ–ø–∫–∞ "Undo"
const previewBtn = document.getElementById('previewBtn'); // –∫–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–≥–ª—è–¥"
const downloadBtn = document.getElementById('downloadBtn'); // –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏"
const bgLoader = document.getElementById('bgLoader');¬† ¬† ¬†// –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á —Ñ–æ–Ω—É
const collage = document.getElementById('collage');¬† ¬† ¬† ¬†// –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–ª–∞–∂—É
const vowse = document.getElementById('vowse');¬† ¬† ¬† ¬† ¬† ¬†// –±–ª–æ–∫ –¥–ª—è –∫–ª—è—Ç–≤
const vowsi = document.getElementById('vowsi');¬† ¬† ¬† ¬† ¬† ¬†// —ñ–Ω—à–∏–π –±–ª–æ–∫ –¥–ª—è –∫–ª—è—Ç–≤
const photoBlock = document.querySelector('.photo-block');// –±–ª–æ–∫ –∑ —Ñ–æ—Ç–æ-–∫–Ω–æ–ø–∫–∞–º–∏

/* === –ì–∞–ª–µ—Ä–µ—è —Ñ–æ–Ω—ñ–≤ === */
const url = "https://detectfraud.github.io/gallery/"; // –±–∞–∑–æ–≤–∞ –∞–¥—Ä–µ—Å–∞ –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω—å
const images = [ "nature(1)","nature(2)","nature(3)","nature(4)","nature(5)",
¬† "nature(6)","nature(7)","nature(8)","nature(9)","Fon" ]; // —Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω—ñ–≤
const fullImages = images.map(name => url + name + ".jpeg"); // —Ñ–æ—Ä–º—É—î–º–æ –ø–æ–≤–Ω—ñ URL
let startIndex = 0; // —ñ–Ω–¥–µ–∫—Å –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å–ª–∞–π–¥—É

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–º–∞–ª—å–æ–≤–∫–∏ 3-—Ö –º—ñ–Ω—ñ–∞—Ç—é—Ä —Ñ–æ–Ω—ñ–≤
function renderThumbnails() {
¬† ¬† thumbs.innerHTML = "";
¬† ¬† // –ü–µ—Ä–µ–¥–∞—î–º–æ 'bg' —è–∫ –∫–ª—é—á —à–∞—Ä—É
¬† ¬† fullImages.slice(startIndex, startIndex + 3).forEach(src => createThumb(src, thumbs, 'bg'));
}

// —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–¥–Ω—ñ—î—ó –º—ñ–Ω—ñ–∞—Ç—é—Ä–∏ (—Ñ–æ–Ω –∞–±–æ –∫–ª—è—Ç–≤–∞)
function createThumb(src, container, key) {
¬† ¬† const wrapper = document.createElement("div");
¬† ¬† wrapper.className = "thumb-wrapper";

¬† ¬† const imgName = src.split("/").pop().split(".")[0]; // –Ω–∞–∑–≤–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏

¬† ¬† const thumb = document.createElement("img");
¬† ¬† thumb.className = "thumb";
¬† ¬† thumb.src = src;

¬† ¬† const big = document.createElement("img");
¬† ¬† big.className = "imagbox";
¬† ¬† big.src = src;

¬† ¬† // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –¥–ª—è –≤—Å—ñ—Ö –≥–∞–ª–µ—Ä–µ–π
¬† ¬† if (imgName === "Fon") {
¬† ¬† ¬† ¬† // –°–ø–µ—Ü. –ø—É–Ω–∫—Ç ‚Üí "–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–≤—ñ–π —Ñ–æ–Ω"
¬† ¬† ¬† ¬† thumb.title = "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–≤—ñ–π —Ñ–æ–Ω";
¬† ¬† ¬† ¬† thumb.onclick = () => bgLoader.click();
¬† ¬† } else {
¬† ¬† ¬† ¬† // –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≥–æ—Ç–æ–≤–∏–π —Ñ–æ–Ω –∞–±–æ –∫–ª—è—Ç–≤—É –∑ –≥–∞–ª–µ—Ä–µ—ó
¬† ¬† ¬† ¬† thumb.onclick = () => handleFileFromGallery(src, key);
¬† ¬† }

¬† ¬† wrapper.appendChild(thumb);
¬† ¬† wrapper.appendChild(big);
¬† ¬† container.appendChild(wrapper);
}

// –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å–ª–∞–π–¥—ñ–≤ —É –≥–∞–ª–µ—Ä–µ—ó —Ñ–æ–Ω—ñ–≤
function prevSlide(){
¬† startIndex=(startIndex-3+fullImages.length)%fullImages.length;
¬† renderThumbnails();
}
function nextSlide(){
¬† startIndex=(startIndex+3)%fullImages.length;
¬† renderThumbnails();
}

/* === –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≥–æ—Ç–æ–≤–∏–π —Ñ–æ–Ω —ñ–∑ –≥–∞–ª–µ—Ä–µ—ó === */
function handleFileFromGallery(src,key){
¬† const img=new Image();
¬† img.crossOrigin="anonymous"; // –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É CORS
¬† img.onload=()=>{
¬† ¬† // —Ä–æ–∑–º—ñ—â—É—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ —à–∞—Ä—ñ
¬† ¬† layers[key].img=img;
¬† ¬† layers[key].src=src;
¬† ¬† layers[key].x=canvas.width/2;
¬† ¬† layers[key].y=canvas.height/2;
¬† ¬† layers[key].scale=1;
¬† ¬† activeLayer=key;
¬† ¬† scaleSlider.value=1;
¬† ¬† pushHistory(); // –¥–æ–¥–∞—î–º–æ –≤ —ñ—Å—Ç–æ—Ä—ñ—é
¬† ¬† drawAll();¬† ¬† ¬†// –ø–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ –≤—Å–µ
¬† };
¬† img.src=src;
}

/* === –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ/—Ñ–æ–Ω—ñ–≤ –∑ —Ñ–∞–π–ª—É === */
function handleFileLoad(file,key){
¬† if(!file) return;
¬† const reader=new FileReader();
¬† reader.onload=e=>{
¬† ¬† const data=e.target.result;
¬† ¬† const img=new Image();
¬† ¬† img.onload=()=>{
¬† ¬† ¬† layers[key].img=img;
¬† ¬† ¬† layers[key].src=data;
¬† ¬† ¬† layers[key].x=canvas.width/2;
¬† ¬† ¬† layers[key].y=canvas.height/2;
¬† ¬† ¬† layers[key].scale=1;
¬† ¬† ¬† activeLayer=key;
¬† ¬† ¬† scaleSlider.value=1;
¬† ¬† ¬† pushHistory();
¬† ¬† ¬† drawAll();
¬† ¬† };
¬† ¬† img.src=data;
¬† };
¬† reader.readAsDataURL(file);
}

// –ü—Ä–∏–≤'—è–∑–∫–∞ input-–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á—ñ–≤ –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π
bgLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'bg'));
loveLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'love'));
document.getElementById("fot").onclick=()=>loveLoader.click();

// –∑–∞–ø—É—Å–∫–∞—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥–∞–ª–µ—Ä–µ—ó —Ñ–æ–Ω—ñ–≤ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
renderThumbnails();


/* === –ì–∞–ª–µ—Ä–µ—è –∫–ª—è—Ç–≤ === */
const vows=["LoveStones","Eternity","Fidelity","Joy","LoveStones","Love","Strength","Tenderness","LoveStones","Trust","Unity","Heart"];
const fullVows=vows.map(name=>url+name+".png"); // —Ñ–æ—Ä–º—É—î–º–æ URL –∫–ª—è—Ç–≤
let vowIndex=0;

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–º–∞–ª—å–æ–≤–∫–∏ 4-—Ö –º—ñ–Ω—ñ–∞—Ç—é—Ä –∫–ª—è—Ç–≤
function renderVows() {
¬† ¬† thumbsVows.innerHTML = "";
¬† ¬† // –ü–µ—Ä–µ–¥–∞—î–º–æ 'vow' —è–∫ –∫–ª—é—á —à–∞—Ä—É
¬† ¬† fullVows.slice(vowIndex, vowIndex + 4).forEach(src => createThumb(src, thumbsVows, 'vow'));
}
function prevVow(){ vowIndex=(vowIndex-4+fullVows.length)%fullVows.length; renderVows(); }
function nextVow(){ vowIndex=(vowIndex+4)%fullVows.length; renderVows(); }


/* === –®–∞—Ä–∏ —ñ –º–∞—Å–∫–∞ (–∫—Ä—É–≥–ª–∞ –¥—ñ—Ä–∞ –¥–ª—è —Ñ–æ—Ç–æ) === */
const template=new Image(); template.src='images/composit.png';
const HOLE_OFFSET_X=6, HOLE_OFFSET_Y=-115, HOLE_RADIUS=98;
let mask={cx:canvas.width/2+HOLE_OFFSET_X, cy:canvas.height/2+HOLE_OFFSET_Y, r:HOLE_RADIUS};

// –æ–ø–∏—Å —à–∞—Ä—ñ–≤
let layers={
¬† ¬† bg:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
¬† ¬† love:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
¬† ¬† vow:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1} // –ù–æ–≤–∏–π —à–∞—Ä –¥–ª—è –∫–ª—è—Ç–≤
};
let activeLayer=null, previewMode=false, bgHoleActive=true;

// —ñ—Å—Ç–æ—Ä—ñ—è –¥–ª—è Undo
const history=[]; const MAX_HISTORY=20;
function makeSnapshot(){ return { bg:{...layers.bg}, love:{...layers.love}, vow:{...layers.vow}, previewMode, activeLayer, bgHoleActive }; } // –ó–º—ñ–Ω–µ–Ω–æ: –î–æ–¥–∞–Ω–æ —à–∞—Ä 'vow'
function pushHistory(){ history.push(makeSnapshot()); if(history.length>MAX_HISTORY) history.shift(); }
function applySnapshot(s){
¬† previewMode=!!s.previewMode; activeLayer=s.activeLayer||null; bgHoleActive=!!s.bgHoleActive;
¬† // –ó–º—ñ–Ω–µ–Ω–æ: –î–æ–¥–∞–Ω–æ —à–∞—Ä 'vow' –¥–æ —Ü–∏–∫–ª—É
¬† ['bg','love','vow'].forEach(key=>{
¬† ¬† const v=s[key];
¬† ¬† if(v && v.src){
¬† ¬† ¬† const img=new Image();
¬† ¬† ¬† img.onload=()=>{ layers[key].img=img; layers[key].src=v.src; layers[key].x=v.x; layers[key].y=v.y; layers[key].scale=v.scale; drawAll(); };
¬† ¬† ¬† img.src=v.src;
¬† ¬† } else {
¬† ¬† ¬† layers[key].img=null; layers[key].src=null;
¬† ¬† ¬† layers[key].x=v? v.x: canvas.width/2;
¬† ¬† ¬† layers[key].y=v? v.y: canvas.height/2;
¬† ¬† ¬† layers[key].scale=v? v.scale:1;
¬† ¬† }
¬† });
¬† toggleButtons();
}


/* === –ú–∞–ª—é–≤–∞–Ω–Ω—è === */
// –º–∞–ª—é—î–º–æ –±—É–¥—å-—è–∫–∏–π —à–∞—Ä
function drawLayerTo(ctxTarget, layer){
¬† if(!layer||!layer.img) return;
¬† const w=layer.img.width*layer.scale,h=layer.img.height*layer.scale;
¬† ctxTarget.drawImage(layer.img, layer.x-w/2, layer.y-h/2, w, h);
}

// –º–∞–ª—é—î–º–æ –∫–ª—è—Ç–≤–∏ (–∑ –æ–ø—Ü—ñ—î—é –æ–±—Ä—ñ–∑–∫–∏ –ø–æ –∫–æ–ª—É)
function drawLove(ctxTarget, clip=false){
¬† const L=layers.love;
¬† if(!L||!L.img) return;
¬† const w=L.img.width*L.scale,h=L.img.height*L.scale;
¬† ctxTarget.save();
¬† if(clip&&mask.r>0){ ctxTarget.beginPath(); ctxTarget.arc(mask.cx,mask.cy,mask.r,0,Math.PI*2); ctxTarget.clip(); }
¬† ctxTarget.drawImage(L.img,L.x-w/2,L.y-h/2,w,h);
¬† ctxTarget.restore();
}

// –º–∞–ª—é—î–º–æ —Ñ–æ–Ω –∑ "–¥—ñ—Ä–∫–æ—é"
function drawBgWithHole(ctxTarget){
¬† if(!layers.bg.img) return;
¬† if(!bgHoleActive||mask.r<=0){ drawLayerTo(ctxTarget,layers.bg); return; }
¬† const off=document.createElement('canvas');
¬† off.width=canvas.width; off.height=canvas.height;
¬† const octx=off.getContext('2d');
¬† drawLayerTo(octx,layers.bg);
¬† octx.globalCompositeOperation='destination-out';
¬† octx.beginPath(); octx.arc(mask.cx,mask.cy,mask.r,0,Math.PI*2);
¬† octx.fill();
¬† octx.globalCompositeOperation='source-over';
¬† ctxTarget.drawImage(off,0,0);
}

// –ø–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ –≤—Å–µ –ø–æ–ª–æ—Ç–Ω–æ
function drawAll(){
¬† ¬† ctx.clearRect(0, 0, canvas.width, canvas.height);
¬† ¬† // –ó–º—ñ–Ω–µ–Ω–æ: —Ç–µ–ø–µ—Ä –ø–æ—Ä—è–¥–æ–∫ –º–∞–ª—é–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö —Ä–µ–∂–∏–º—ñ–≤
¬† ¬† drawBgWithHole(ctx);
¬† ¬† drawLove(ctx, previewMode); // –ó–º—ñ–Ω–µ–Ω–æ: drawLove —Ç–µ–ø–µ—Ä –ø—Ä–∏–π–º–∞—î previewMode –¥–ª—è –æ–±—Ä—ñ–∑–∫–∏
¬† ¬† drawLayerTo(ctx, layers.vow);

¬† ¬† if(template.complete) {
¬† ¬† ¬† ¬† ctx.drawImage(template, 0, 0, canvas.width, canvas.height);
¬† ¬† }
}

/* === –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—ñ–≤ === */
function toggleButtons(){
¬† if(previewMode){
¬† ¬† // —Ä–µ–∂–∏–º –ø–µ—Ä–µ–≥–ª—è–¥—É
¬† ¬† previewBtn.style.display = 'none';
¬† ¬† downloadBtn.style.display = 'inline-block';
¬† ¬† if (vowsi) vowsi.style.display = 'none';
¬† ¬† if (photoBlock) photoBlock.style.display = 'none';
¬† ¬† if (vowse) vowse.style.display = 'inline-block';
¬† ¬† setDisabled(true);
¬† } else {
¬† ¬† // —Ä–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
¬† ¬† previewBtn.style.display = 'inline-block';
¬† ¬† downloadBtn.style.display = 'none';
¬† ¬† if (vowsi) vowsi.style.display = 'inline-block';
¬† ¬† if (photoBlock) photoBlock.style.display = 'inline-block';
¬† ¬† if (vowse) vowse.style.display = 'none';
¬† ¬† setDisabled(false);
¬† }
}


/* === –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è === */
scaleSlider.addEventListener('input',()=>{
¬† if(!activeLayer) return;
¬† layers[activeLayer].scale=parseFloat(scaleSlider.value);
¬† drawAll();
});


/* === Drag & Touch (–ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏–Ω–æ–∫) === */
let dragging=false, dragStartX=0, dragStartY=0;

// –ü–æ—á–∞—Ç–æ–∫ drag –º–∏—à–µ—é
canvas.addEventListener('mousedown',e=>{
¬† if(previewMode||!activeLayer) return;
¬† dragging=true;
¬† dragStartX=e.offsetX-layers[activeLayer].x;
¬† dragStartY=e.offsetY-layers[activeLayer].y;
});

// –†—É—Ö –º–∏—à–µ—é
canvas.addEventListener('mousemove',e=>{
¬† if(previewMode||!dragging||!activeLayer) return;
¬† layers[activeLayer].x=e.offsetX-dragStartX;
¬† layers[activeLayer].y=e.offsetY-dragStartY;
¬† drawAll();
});

// –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è drag
function stopDrag(){
¬† if(previewMode) return;
¬† if(dragging){ dragging=false; pushHistory(); }
}
canvas.addEventListener('mouseup',stopDrag);
canvas.addEventListener('mouseleave',stopDrag);

// Touch-–ø–æ–¥—ñ—ó –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö
canvas.addEventListener('touchstart',e=>{
¬† if(previewMode||!activeLayer) return;
¬† const t=e.touches[0],rect=canvas.getBoundingClientRect();
¬† dragging=true;
¬† dragStartX=t.clientX-rect.left-layers[activeLayer].x;
¬† dragStartY=t.clientY-rect.top-layers[activeLayer].y;
¬† e.preventDefault();
});
canvas.addEventListener('touchmove',e=>{
¬† if(previewMode||!dragging||!activeLayer) return;
¬† const t=e.touches[0],rect=canvas.getBoundingClientRect();
¬† layers[activeLayer].x=t.clientX-rect.left-dragStartX;
¬† layers[activeLayer].y=t.clientY-rect.top-dragStartY;
¬† drawAll();
¬† e.preventDefault();
});
canvas.addEventListener('touchend',stopDrag);


/* === Undo / Preview / Download === */
undoBtn.addEventListener('click',()=>{
¬† if(history.length<=1) return;
¬† history.pop();
¬† applySnapshot(history[history.length-1]);
});
previewBtn.addEventListener('click',()=>{
¬† previewMode=true;
¬† pushHistory();
¬† toggleButtons();
¬† drawAll();
});
downloadBtn.addEventListener('click',()=>{
¬† const link=document.createElement('a');
¬† link.download='composition.png';
¬† link.href=canvas.toDataURL('image/png');
¬† link.click();
});

// –∫–æ–ª–∏ —à–∞–±–ª–æ–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è ‚Üí –ø–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ
template.onload=()=>{ drawAll(); };

// —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–∞–ª–µ—Ä–µ–π
renderThumbnails();
renderVows();
applySnapshot(history[0]||makeSnapshot());


// –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É —Ä–µ–∂–∏–º—ñ –ø–µ—Ä–µ–≥–ª—è–¥—É
function setDisabled(state){
¬† // –ó–º—ñ–Ω–µ–Ω–æ: –î–æ–¥–∞–Ω–æ thumbsVows –¥–æ —Å–ø–∏—Å–∫—É, —â–æ–± –±–ª–æ–∫—É–≤–∞—Ç–∏ –π–æ–≥–æ –≤ —Ä–µ–∂–∏–º—ñ –ø–µ—Ä–µ–≥–ª—è–¥—É
¬† [thumbs, loveLoader, thumbsVows].forEach(el=>{
¬† ¬† if (el) { // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫, —è–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
¬† ¬† ¬† el.disabled=!!state;
¬† ¬† ¬† el.classList.toggle('disabled',!!state);
¬† ¬† }
¬† });
}

// –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–∞–∫–ª–∞–¥–∫–∏ (overlay) –ø–æ–≤–µ—Ä—Ö —à–∞–±–ª–æ–Ω—É
function addOverlay(src,isVow=false){
¬† const newImg=document.createElement("img");
¬† newImg.src=src;
¬† newImg.classList.add("overlay");
¬† if(isVow) newImg.classList.add("vow");
¬† collage.appendChild(newImg);
}

// –∫–Ω–æ–ø–∫–∞ "–æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É"
document.getElementById('updateBtn').addEventListener('click', function () {
¬† ¬† const url = window.location.href.split('?')[0];
¬† ¬† window.location.href = url + '?_=' + new Date().getTime(); // –¥–æ–¥–∞—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —â–æ–± –æ–±—ñ–π—Ç–∏ –∫–µ—à
});
</script>

</body>
</html>
