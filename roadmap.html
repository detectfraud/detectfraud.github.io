<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>–ö–∞–º—ñ–Ω—å –ª—é–±–æ–≤—ñ ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<style>
body { font-family: sans-serif; text-align: center; background: transparent; margin:0; padding:0; }
.venwin { border-radius: 10px; display: inline-block; background-color: rgba(255, 255, 255, 0.5); padding: 20px; box-sizing: border-box; max-width: 95%; width: 950px; }
canvas { border: 3px solid #bbb; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,.1); display: block; margin: 10px auto; width: 100%; height: auto; transition: transform 0.3s ease-in-out; transform-origin: center center; cursor:pointer; position: relative; z-index: 10; }
.preview-zoom-in:hover { transform: scale(1.43);}
#scaleSlider { width: 95%; max-width: 420px; margin: 10px auto; display:block; }
button { padding: 8px 12px; cursor: pointer; border-radius: 8px; }
.disabled { pointer-events: none; opacity: .5; filter: grayscale(100%); }
.gallery-container { display: flex; align-items: flex-start; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
.gallery-block { display: flex; flex-direction: column; align-items: center; gap: 10px; flex: 1 1 200px; }
.gallery-block > div { display: flex; align-items: center; justify-content: center; flex-wrap: wrap;}
.arrow, .arow { font-size: 20px; cursor: pointer; user-select: none; padding: 3px; line-height: 1; display: flex; align-items: center; justify-content: center; }
.thumbnails { display: flex; gap: 10px; overflow-x: auto; max-width: 100%; justify-content: center; }
.thumb-wrapper { position: relative; flex: 0 0 auto; }
.thumb { width: 108px; height: 72px; object-fit: cover; cursor: pointer; box-shadow: 0 0 6px rgba(0,0,0,0.3); transition: all 0.3s ease; z-index: 1; border-radius: 10px; flex:0 0 auto;}
.thumb.active { border: 3px solid red; box-shadow: 0 0 10px red; }
.collage { position: relative; display: inline-block; margin-top: 0; width:100%; }
.button-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top:10px; }
.imagbox { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%) scale(0.1); width: 90%; max-width:825px; height:auto; opacity: 0; transition: all 0.9s ease; z-index: 9999; border-radius: 12px; box-shadow: 0 0 25px rgba(0,0,0,0.7); pointer-events: none; background: #fff; }
.imagbox.show { opacity: 1; transform: translate(-50%,-50%) scale(0.6);}
.photo-block { margin-left: 0; }
#updateBtn { margin-left: 0; margin-top: 10px; font-weight: bold; color: red; }
.donate-btn { position: fixed; bottom: 10px; right: 10px; background-color: #e74c3c; color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 24px; text-decoration: none; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 1000; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
@media (max-width: 1024px){ .venwin { padding: 15px; width: 95%; } #scaleSlider { max-width: 100%; } canvas { height: auto; } .gallery-container { flex-direction: column; align-items: center; } .thumbnails { justify-content: flex-start; overflow-x: auto; }}
@media (max-width: 768px){ .venwin { padding: 10px; } canvas { width: 100%; height: auto; } .button-row { flex-direction: column; }}
</style>
</head>
<body>

<fieldset class="venwin" style="height:auto;">
    <div class="collage" id="collage">
        <canvas id="canvas" width="900" height="600" style="cursor: pointer;border:1px solid #ccc;"></canvas>
        <img id="imagePreview" class="imagbox" src="" alt="Image Preview">
    </div>

    <input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1">

    <div class="gallery-container">
        <div class="gallery-block" id="vowsi">
            <b>–§–æ–Ω</b><br /><br />
            <div>
                <span class="arrow" onclick="prevSlide()">&#10094;</span>
                <div class="thumbnails" id="thumbs"></div>
                <span class="arrow" onclick="nextSlide()">&#10095;</span>
            </div>
        </div>

        <div class="gallery-block" id="vowse" style="display:none;">
            <b>–ö–ª—è—Ç–≤–∏</b><br /><br />
            <div>
                <span class="arrow" onclick="prevVow()">&#10094;</span>
                <div class="thumbnails" id="thumbsVows"></div>
                <span class="arrow" onclick="nextVow()">&#10095;</span>
            </div>
        </div>

        <div class="gallery-block photo-block">
            <b>–í–∞—à–µ —Ñ–æ—Ç–æ</b><br /><br />
            <div>
                <label id="fot" class="disabled" title="–§–æ—Ç–æ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö"></label>
            </div>
        </div>
    </div>

    <p class="button-row">
        <button id="undoBtn" type="button">‚ü≤ Undo</button>
        <button id="previewBtn" type="button" class="disabled">üëÅ –ü–µ—Ä–µ–≥–ª—è–¥</button>
        <button id="downloadBtn" type="button" style="display:none;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
        <button id="updateBtn" type="button">UPDATE</button>
    </p>

    <input type="file" id="bgLoader" style="display:none" accept="image/*">
    <input type="file" id="loveLoader" style="display:none" accept="image/*">
</fieldset>

<a href="https://intuit-portal.blogspot.com/p/donate.html" class="donate-btn" target="_blank" title="–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç">‚ù§Ô∏è</a>

<script>
// === JS: —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥ ===
const allowedDomains = ['intuit-portal.blogspot.com', 'detectfraud.github.io'];
const currentHost = window.location.hostname;
const referrerHost = document.referrer ? new URL(document.referrer).hostname : '';
const isAllowed = allowedDomains.some(domain => currentHost.includes(domain)) || allowedDomains.some(domain => referrerHost.includes(domain));
if (!isAllowed) {
    document.body.innerHTML = '<h1>–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ</h1><p>–¶–µ–π –¥–æ–¥–∞—Ç–æ–∫ –º–æ–∂–µ –±—É—Ç–∏ –≤–±—É–¥–æ–≤–∞–Ω–∏–π –ª–∏—à–µ –Ω–∞ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–º—É —Å–∞–π—Ç—ñ intuit-portal.blogspot.com</p>';
    throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ');
}

// –û—Å–Ω–æ–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');
const thumbsVows = document.getElementById('thumbsVows');
const scaleSlider = document.getElementById('scaleSlider');
const undoBtn = document.getElementById('undoBtn');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const bgLoader = document.getElementById('bgLoader');
const loveLoader = document.getElementById('loveLoader');
const collage = document.getElementById('collage');
const vowse = document.getElementById('vowse');
const vowsi = document.getElementById('vowsi');
const photoBlock = document.querySelector('.photo-block');
const imagePreview = document.getElementById('imagePreview');

// –ì–∞–ª–µ—Ä–µ—ó —Ç–∞ —ñ–Ω–¥–µ–∫—Å–∏
const url = "https://detectfraud.github.io/gallery/";
const images = [ "nature(1)","nature(2)","nature(3)","nature(4)","nature(5)", "nature(6)","nature(7)","nature(8)","nature(9)","Fon" ];
const fullImages = images.map(name => url + name + ".jpeg");
let startIndex = 0;
const vows = ["Eternity","Fidelity","Joy","Love","Strength","Tenderness","Trust","Unity","Heart","Hearts"];
const fullVows = vows.map(name => url + name + ".png");
let vowIndex = 0;
const lovestoneImages = ["LoveStones"];
const fullLovestones = lovestoneImages.map(name => url + name + ".png");
let lovestoneIndex = 0;

// –ê–∫—Ç–∏–≤–Ω—ñ –º—ñ–Ω—ñ–∞—Ç—é—Ä–∏
let activeThumb = { bg: null, vow: null };

// –õayers
let layers = {
    bg:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
    love:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1}
};
let history = [];

// –§—É–Ω–∫—Ü—ñ—ó
function drawCanvas(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(layers.bg.img) ctx.drawImage(layers.bg.img, canvas.width/2 - layers.bg.img.width*layers.bg.scale/2, canvas.height/2 - layers.bg.img.height*layers.bg.scale/2, layers.bg.img.width*layers.bg.scale, layers.bg.img.height*layers.bg.scale);
    if(layers.love.img) ctx.drawImage(layers.love.img, layers.love.x - layers.love.img.width*layers.love.scale/2, layers.love.y - layers.love.img.height*layers.love.scale/2, layers.love.img.width*layers.love.scale, layers.love.img.height*layers.love.scale);
}
function addHistory(){
    history.push({bg:{...layers.bg}, love:{...layers.love}});
    if(history.length>10) history.shift();
}
undoBtn.addEventListener('click',()=>{
    if(history.length>0){
        let last = history.pop();
        layers.bg = last.bg;
        layers.love = last.love;
        drawCanvas();
    }
});
scaleSlider.addEventListener('input', ()=>{
    layers.love.scale = parseFloat(scaleSlider.value);
    drawCanvas();
});
function loadImage(src,layerKey){
    let img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = ()=>{
        layers[layerKey].img = img;
        layers[layerKey].src = src;
        drawCanvas();
        addHistory();
    };
    img.src = src;
}

// –ì–∞–ª–µ—Ä–µ—ó
function populateThumbs(){
    thumbs.innerHTML = '';
    fullImages.forEach((src,i)=>{
        let img = document.createElement('img');
        img.src = src;
        img.className = 'thumb';
        img.addEventListener('click',()=>{ loadImage(src,'bg'); setActiveThumb('bg',img); });
        thumbs.appendChild(img);
    });
    thumbsVows.innerHTML = '';
    fullVows.forEach((src,i)=>{
        let img = document.createElement('img');
        img.src = src;
        img.className = 'thumb';
        img.addEventListener('click',()=>{ loadImage(src,'love'); setActiveThumb('vow',img); });
        thumbsVows.appendChild(img);
    });
}
function setActiveThumb(type,img){
    if(type==='bg' && activeThumb.bg) activeThumb.bg.classList.remove('active');
    if(type==='vow' && activeThumb.vow) activeThumb.vow.classList.remove('active');
    img.classList.add('active');
    if(type==='bg') activeThumb.bg = img; else activeThumb.vow = img;
}

// Prev/Next
function prevSlide(){ startIndex = (startIndex-1+fullImages.length)%fullImages.length; loadImage(fullImages[startIndex],'bg'); }
function nextSlide(){ startIndex = (startIndex+1)%fullImages.length; loadImage(fullImages[startIndex],'bg'); }
function prevVow(){ vowIndex = (vowIndex-1+fullVows.length)%fullVows.length; loadImage(fullVows[vowIndex],'love'); }
function nextVow(){ vowIndex = (vowIndex+1)%fullVows.length; loadImage(fullVows[vowIndex],'love'); }

// Drag & Drop
let isDragging=false;
canvas.addEventListener('mousedown',e=>{isDragging=true;});
canvas.addEventListener('mouseup',e=>{isDragging=false;});
canvas.addEventListener('mousemove',e=>{
    if(isDragging && layers.love.img){
        layers.love.x = e.offsetX;
        layers.love.y = e.offsetY;
        drawCanvas();
    }
});
canvas.addEventListener('touchstart',e=>{isDragging=true; e.preventDefault();});
canvas.addEventListener('touchend',e=>{isDragging=false;});
canvas.addEventListener('touchmove',e=>{
    if(isDragging && layers.love.img){
        let rect = canvas.getBoundingClientRect();
        layers.love.x = e.touches[0].clientX - rect.left;
        layers.love.y = e.touches[0].clientY - rect.top;
        drawCanvas();
    }
});

// –ü—Ä–µ–≤‚Äô—é
previewBtn.addEventListener('click',()=>{
    if(layers.bg.img || layers.love.img){
        imagePreview.src = canvas.toDataURL("image/png");
        imagePreview.classList.add('show');
        setTimeout(()=>imagePreview.classList.remove('show'),2000);
    }
});

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
populateThumbs();
drawCanvas();
</script>

</body>
</html>
