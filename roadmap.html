<!-- Collage (18:00 26.08.25) -->
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>–ö–∞–º—ñ–Ω—å –ª—é–±–æ–≤—ñ ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<style>
body { font-family: sans-serif; text-align:center; background:url(https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjghIwEmgtr9VAIzGM4eS8BdLA1nptupwYDch46JvrMH9AILVqnNpUX_vxUtQe2Kr-eNLgXcUu_dfNCc7P45vPblF37xpoN8dbLsm9VHiMKmYf58ixmJeQHTY4R4hvGXj0nC7SqiD_2UWRGvIDgUrvZqoVqq8qT61yJB846igsv4ceY7Q/s1600/fon.png) repeat scroll top left; }  /*background:#f5f5f5;*/
.venwin {  border-radius:10px;  display:inline-block; background:url(https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjghIwEmgtr9VAIzGM4eS8BdLA1nptupwYDch46JvrMH9AILVqnNpUX_vxUtQe2Kr-eNLgXcUu_dfNCc7P45vPblF37xpoN8dbLsm9VHiMKmYf58ixmJeQHTY4R4hvGXj0nC7SqiD_2UWRGvIDgUrvZqoVqq8qT61yJB846igsv4ceY7Q/s1600/fon.png) repeat scroll top left; }   /*padding:10px;*/
canvas { border:3px solid #bbb; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,.1); display:block; margin:10px auto; }
#scaleSlider { width:420px;}
button { padding:8px 12px; cursor:pointer; border-radius:8px; }
.disabled { pointer-events:none; opacity:.5; filter:grayscale(100%); }

.gallery-container { display:flex; align-items:flex-start; justify-content:center; gap:10px; margin-top:20px; }
.gallery-block { display:flex; flex-direction:column; align-items:center; gap:10px; }
.gallery-block > div { display:flex; align-items:center; justify-content:center; }
.arrow, .arow { font-size:20px; cursor:pointer; user-select:none; padding:3px; line-height:1; display:flex; align-items:center; justify-content:center;  }
.arrow:first-child { margin-right:-110px; } .arrow:last-child { margin-left:-110px; }
.arow:first-child { margin-right:-60px; }
.arow:last-child { margin-left:-60px; }
.thumbnails { display:flex; gap:10px; overflow:hidden; width:600px; justify-content:center; }
.thumb-wrapper { position:relative; }
.thumb { width:108px; height:72px; object-fit:cover; border-radius:8px; cursor:pointer; box-shadow:0 0 6px rgba(0,0,0,0.3); transition:all 0.3s ease; z-index:1; }
.collage { position:relative; display:inline-block; margin-top:40px; }
.collage img.overlay { position:absolute; bottom:10px; right:10px; width:500px; border-radius:8px; box-shadow:0 0 8px rgba(0,0,0,0.4); }

#fot { display:inline-block; cursor:pointer; border-radius:8px; width:108px; height:72px; background-image:url(https://detectfraud.github.io/gallery/Para.png); background-repeat:no-repeat; background-size:contain; }
#fot:hover { mix-blend-mode:luminosity; }
#fot:active { mix-blend-mode:exclusion; }

.imagbox { position:fixed; top:50%; left:50%; width:825px; height:510px; transform:translate(-50%,-50%) scale(0.1); opacity:0; transition:all 0.5s ease; z-index:9999; border-radius:12px; box-shadow:0 0 25px rgba(0,0,0,0.7); pointer-events:none; background:#fff; }
.thumb-wrapper:hover .imagbox { opacity:1; transform:translate(-50%,-50%) scale(0.6); }
.photo-block { margin-left:100px; }
#updateBtn { margin-left:300px;font-weight:bold;color:red; }
.gallery-container.vows .labels { display:grid; grid-template-columns:repeat(4,1fr); text-align:center; margin-bottom:5px; }
.gallery-container.vows .labels .label1 { grid-column:1; font-weight:bold; margin-left:70px; }
.gallery-container.vows .labels .label2 { grid-column:3; font-weight:bold; }
.arrow, .arow {  position:relative; z-index:3; }
</style>
</head>
<body>

<fieldset class="venwin" style="height:auto;">
<div class="collage" id="collage">
  <canvas id="canvas" width="900" height="600" style="border:1px solid #ccc;"></canvas>
</div>

<br><input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1"><br><br>

<!-- –ì–∞–ª–µ—Ä–µ—è —Ñ–æ–Ω—ñ–≤ -->
<div class="gallery-container">
  <div class="gallery-block" id="vowsi">
    <b>–§–æ–Ω</b>
    <div>
      <span class="arrow" onclick="prevSlide()">&#10094;</span>
      <div class="thumbnails" id="thumbs"></div>
      <span class="arrow" onclick="nextSlide()">&#10095;</span>
    </div>
  </div>

  <div class="gallery-block photo-block">
    <b>–§–æ—Ç–æ</b>
    <label id="fot" title="–§–æ—Ç–æ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö"></label>
  </div>
</div>

<!-- –ì–∞–ª–µ—Ä–µ—è –∫–ª—è—Ç–≤ -->
<div class="gallery-container vows" id="vowse" style="display:none;">
  <div class="gallery-block">
    <div class="labels">
      <span class="label1">–ù–∞–¥–ø–∏—Å</span>
      <span class="label2">–ö–ª—è—Ç–≤–∞ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö</span>
    </div>
    <div class="gallery-row">
      <span class="arow" onclick="prevVow()">&#10094;</span>
      <div class="thumbnails" id="thumbsVows"></div>
      <span class="arow" onclick="nextVow()">&#10095;</span>
    </div>
  </div>
</div>
<br><br>
  <div>
<button id="undoBtn" type="button">‚ü≤ Undo</button>
<button id="previewBtn" type="button">üëÅ –ü–µ—Ä–µ–≥–ª—è–¥</button>
<button id="downloadBtn" type="button" style="display:none;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
     
  <button id="updateBtn" type="button">UPDATE</button>
</div> </fieldset>
<input type="file" id="bgLoader" style="display:none">
<input type="file" id="loveLoader" style="display:none">
<script>
/* === Collage JS === */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');
const thumbsVows = document.getElementById('thumbsVows');
const loveLoader = document.getElementById('loveLoader');
const scaleSlider = document.getElementById('scaleSlider');
const undoBtn = document.getElementById('undoBtn');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const bgLoader = document.getElementById('bgLoader');
const vowse = document.getElementById('vowse');
const vowsi = document.getElementById('vowsi');
const photoBlock = document.querySelector('.photo-block');

const url = "https://detectfraud.github.io/gallery/";
const images = ["nature(1)","nature(2)","nature(3)","nature(4)","nature(5)","nature(6)","nature(7)","nature(8)","nature(9)","Fon"];
const fullImages = images.map(name => url + name + ".jpeg");
let startIndex = 0;

function renderThumbnails(){
  thumbs.innerHTML="";
  fullImages.slice(startIndex,startIndex+3).forEach(src=>createThumb(src, thumbs, false));
}

function createThumb(src, container, isVow){
  const wrapper=document.createElement("div");
  wrapper.className="thumb-wrapper";
  const imgName=src.split("/").pop().split(".")[0];
  const thumb=document.createElement("img");
  thumb.className="thumb"; thumb.src=src;
  const big=document.createElement("img"); big.className="imagbox"; big.src=src;

  if(isVow){
    thumb.onclick=()=>addOverlay(src,true);
  } else {
    if(imgName==="Fon"){ thumb.title="–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–≤—ñ–π —Ñ–æ–Ω"; thumb.onclick=()=>bgLoader.click(); }
    else{ thumb.onclick=()=>handleFileFromGallery(src,"bg"); }
  }

  wrapper.appendChild(thumb); wrapper.appendChild(big); container.appendChild(wrapper);
}

function prevSlide(){ startIndex=(startIndex-3+fullImages.length)%fullImages.length; renderThumbnails(); }
function nextSlide(){ startIndex=(startIndex+3)%fullImages.length; renderThumbnails(); }

/* === –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≥–æ—Ç–æ–≤–∏–π —Ñ–æ–Ω === */
function handleFileFromGallery(src,key){
  const img=new Image(); img.crossOrigin="anonymous";
  img.onload=()=>{
    layers[key].img=img; layers[key].src=src; layers[key].x=canvas.width/2; layers[key].y=canvas.height/2;
    layers[key].scale=1; activeLayer=layers[key]; scaleSlider.value=1; pushHistory(); drawAll();
  }; img.src=src;
}

/* === –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ/—Ñ–æ–Ω—ñ–≤ === */
function handleFileLoad(file,key){
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    const data=e.target.result;
    const img=new Image();
    img.onload=()=>{
      layers[key].img=img; layers[key].src=data; layers[key].x=canvas.width/2; layers[key].y=canvas.height/2;
      layers[key].scale=1; activeLayer=layers[key]; scaleSlider.value=1; pushHistory(); drawAll();
    };
    img.src=data;
  };
  reader.readAsDataURL(file);
}

bgLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'bg'));
loveLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'love'));
document.getElementById("fot").onclick=()=>loveLoader.click();

/* === –ì–∞–ª–µ—Ä–µ—è –∫–ª—è—Ç–≤ === */
const vows=["LoveStones","Eternity","Fidelity","Joy","LoveStones","Love","Strength","Tenderness","LoveStones","Trust","Unity","Heart"];
const fullVows=vows.map(name=>url+name+".png");
let vowIndex=0;
function renderVows(){ thumbsVows.innerHTML=""; fullVows.slice(vowIndex,vowIndex+4).forEach(src=>createThumb(src, thumbsVows, true)); }
function prevVow(){ vowIndex=(vowIndex-4+fullVows.length)%fullVows.length; renderVows(); }
function nextVow(){ vowIndex=(vowIndex+4)%fullVows.length; renderVows(); }

/* === –®–∞—Ä–∏ —ñ –º–∞—Å–∫–∞ === */
const template=new Image(); template.src='images/composit.png';
let layers={ bg:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1}, love:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1} };
let vowLayers=[]; // –Ω–æ–≤—ñ —à–∞—Ä–∏ –¥–ª—è –∫–ª—è—Ç–≤
let activeLayer=null, previewMode=false, bgHoleActive=true;
const history=[]; const MAX_HISTORY=20;

function makeSnapshot(){ 
  return { bg:{...layers.bg}, love:{...layers.love}, vowLayers:vowLayers.map(l=>({...l})), previewMode, activeLayer, bgHoleActive }; 
}
function pushHistory(){ history.push(makeSnapshot()); if(history.length>MAX_HISTORY) history.shift(); }

function applySnapshot(s){
  previewMode=!!s.previewMode; activeLayer=s.activeLayer||null; bgHoleActive=!!s.bgHoleActive;
  ['bg','love'].forEach(key=>{
    const v=s[key]; 
    if(v && v.src){ const img=new Image(); img.onload=()=>{ layers[key].img=img; layers[key].src=v.src; layers[key].x=v.x; layers[key].y=v.y; layers[key].scale=v.scale; drawAll(); }; img.src=v.src; } 
    else{ layers[key].img=null; layers[key].src=null; layers[key].x=v? v.x:canvas.width/2; layers[key].y=v? v.y:canvas.height/2; layers[key].scale=v? v.scale:1; }
  });
  vowLayers = s.vowLayers ? s.vowLayers.map(l=>{ const img=new Image(); img.src=l.src; return {...l,img}; }) : [];
  toggleButtons();
}

/* === –ú–∞–ª—é–≤–∞–Ω–Ω—è —à–∞—Ä—ñ–≤ === */
function drawLayerTo(ctxTarget, layer){ if(!layer||!layer.img) return; const w=layer.img.width*layer.scale,h=layer.img.height*layer.scale; ctxTarget.drawImage(layer.img, layer.x-w/2, layer.y-h/2, w, h); }

function drawAll(){ 
  ctx.clearRect(0,0,canvas.width,canvas.height); 
  drawLayerTo(ctx,layers.bg);
  drawLayerTo(ctx,layers.love);
  vowLayers.forEach(layer=>drawLayerTo(ctx,layer));
  if(template.complete) ctx.drawImage(template,0,0,canvas.width,canvas.height); 
}

/* === Drag & Touch === */
let dragging=false, dragStartX=0, dragStartY=0;
canvas.addEventListener('mousedown',e=>{ if(previewMode||!activeLayer) return; dragging=true; dragStartX=e.offsetX-activeLayer.x; dragStartY=e.offsetY-activeLayer.y; });
canvas.addEventListener('mousemove',e=>{ if(previewMode||!dragging||!activeLayer) return; activeLayer.x=e.offsetX-dragStartX; activeLayer.y=e.offsetY-dragStartY; drawAll(); });
function stopDrag(){ if(previewMode) return; if(dragging){ dragging=false; pushHistory(); } }
canvas.addEventListener('mouseup',stopDrag); canvas.addEventListener('mouseleave',stopDrag);
canvas.addEventListener('touchstart',e=>{ if(previewMode||!activeLayer) return; const t=e.touches[0],rect=canvas.getBoundingClientRect(); dragging=true; dragStartX=t.clientX-rect.left-activeLayer.x; dragStartY=t.clientY-rect.top-activeLayer.y; e.preventDefault(); });
canvas.addEventListener('touchmove',e=>{ if(previewMode||!dragging||!activeLayer) return; const t=e.touches[0],rect=canvas.getBoundingClientRect(); activeLayer.x=t.clientX-rect.left-dragStartX; activeLayer.y=t.clientY-rect.top-dragStartY; drawAll(); e.preventDefault(); });
canvas.addEventListener('touchend',stopDrag);

/* === –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è === */
scaleSlider.addEventListener('input',()=>{ if(!activeLayer) return; activeLayer.scale=parseFloat(scaleSlider.value); drawAll(); });

/* === Undo / Preview / Download === */
undoBtn.addEventListener('click',()=>{ if(history.length<=1) return; history.pop(); applySnapshot(history[history.length-1]); });
previewBtn.addEventListener('click',()=>{ previewMode=true; pushHistory(); toggleButtons(); drawAll(); });
downloadBtn.addEventListener('click',()=>{ const link=document.createElement('a'); link.download='composition.png'; link.href=canvas.toDataURL('image/png'); link.click(); });

function toggleButtons(){
  if(previewMode){ previewBtn.style.display='none'; downloadBtn.style.display='inline-block'; if(vowsi) vowsi.style.display='none'; if(photoBlock) photoBlock.style.display='none'; if(vowse) vowse.style.display='inline-block'; setDisabled(true); }
  else{ previewBtn.style.display='inline-block'; downloadBtn.style.display='none'; if(vowsi) vowsi.style.display='inline-block'; if(photoBlock) photoBlock.style.display='inline-block'; if(vowse) vowse.style.display='none'; setDisabled(false); }
}

function setDisabled(state){ [thumbs,loveLoader].forEach(el=>{ el.disabled=!!state; el.classList.toggle('disabled',!!state); }); }

/* === –î–æ–¥–∞—Ç–∏ –∫–ª—è—Ç–≤—É === */
function addOverlay(src,isVow=false){
  if(isVow){
    const img=new Image(); img.src=src;
    img.onload=()=>{
      const newLayer = { img:img, src:src, x:canvas.width- img.width/2 -10, y:canvas.height - img.height/2 -10, scale:1 };
      vowLayers.push(newLayer); activeLayer=newLayer; scaleSlider.value=1; pushHistory(); drawAll();
    };
  }
}

/* === –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è === */
renderThumbnails(); renderVows(); applySnapshot(history[0]||makeSnapshot());
template.onload=()=>{ drawAll(); };

</script>

</body>
</html>
