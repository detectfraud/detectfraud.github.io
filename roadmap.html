<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>–ö–∞–º—ñ–Ω—å –ª—é–±–æ–≤—ñ ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<style>
body { font-family: sans-serif; text-align: center; background: transparent; }
.venwin { border-radius: 10px; display: inline-block; background-color: rgba(255, 255, 255, 0.5); padding: 20px; box-sizing: border-box; border-color:transparent; }
canvas { border: 3px solid #bbb; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,.1); display: block; margin: 10px auto; width: 630px; height: 420px; transition: transform 0.3s ease-in-out; transform-origin: top center; cursor:pointer; position: relative; z-index: 10; }
.preview-zoom-in:hover { transform: scale(1.43); }
#scaleSlider { width: 420px; }
button { padding: 8px 12px; cursor: pointer; border-radius: 8px; }
.disabled { pointer-events: none; opacity: .5; filter: grayscale(100%); }
.gallery-container { display: flex; align-items: flex-start; justify-content: center; gap: 10px; margin-top: 10px; }
.gallery-block { display: flex; flex-direction: column; align-items: center; gap: 10px; }
.gallery-block > div { display: flex; align-items: center; justify-content: center; }
.arrow, .arow { font-size: 20px; cursor: pointer; user-select: none; padding: 3px; line-height: 1; display: flex; align-items: center; justify-content: center; position: relative; z-index: 3; }
.arrow:first-child { margin-right: -130px; }
.arrow:last-child { margin-left: -130px; }
.arow:first-child { margin-right: -60px; }
.arow:last-child { margin-left: -60px; }
.thumbnails { display: flex; gap: 10px; overflow: hidden; width: 630px; justify-content: center; }
.thumb-wrapper { position: relative; }
.thumb { width: 108px; height: 72px; object-fit: cover; cursor: pointer; box-shadow: 0 0 6px rgba(0,0,0,0.3); transition: all 0.3s ease; z-index: 1; border-radius: 10px; }
.thumb.active { border: 3px solid red; box-shadow: 0 0 10px red; }
.collage { position: relative; display: inline-block; margin-top: 0; }
.gallery-container.vows .labels { display: grid; grid-template-columns: repeat(4, 1fr); text-align: center; margin-bottom: 5px; }
.gallery-container.vows .labels .label1 { grid-column: 1; font-weight: bold; margin-left: 70px; }
.gallery-container.vows .labels .label2 { grid-column: 3; font-weight: bold; }
.button-row { display: flex; justify-content: center; align-items: center; gap: 10px; }
#fot { display: inline-block; cursor: pointer; border-radius: 8px; width: 108px; height: 72px; background-image: url(https://detectfraud.github.io/gallery/Para.png); background-repeat: no-repeat; background-size: contain; }
#fot:hover { mix-blend-mode: luminosity; }
#fot:active { mix-blend-mode: exclusion; }
.imagbox { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%) scale(0.1); width: 825px; height: 510px; opacity: 0; transition: all 0.9s ease; z-index: 9999; border-radius: 12px; box-shadow: 0 0 25px rgba(0,0,0,0.7); pointer-events: none; background: #fff; }
.imagbox.show { opacity: 1; transform: translate(-50%,-50%) scale(0.6); }
.photo-block { margin-left: 100px; }
#updateBtn { margin-left: 300px; font-weight: bold; color: red; }
.donate-btn { position: fixed; bottom: 30px; right: 50%; background-color: #e74c3c; color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 28px; text-decoration: none; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 1000; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
@media (max-width: 768px) {
    .venwin { padding: 10px; }
    canvas { width: 95%; height: auto; }
    #scaleSlider { width: 95%; }
    .gallery-container { flex-direction: column; align-items: center; }
    .thumbnails { width: 100%; justify-content: center; }
    .arrow:first-child, .arrow:last-child { margin: 0 10px; }
    .arow:first-child, .arow:last-child { margin: 0 10px; }
    .photo-block { margin-left: 0; }
    #updateBtn { margin-left: 0; margin-top: 10px; }
    .gallery-container.vows .labels { grid-template-columns: 1fr 1fr; }
    .gallery-container.vows .labels .label1, .gallery-container.vows .labels .label2 { margin: 0; }
    .donate-btn { bottom: 10px; right: 10px; width: 50px; height: 50px; font-size: 24px; }
}
</style>
</head>
<body>
<fieldset class="venwin" style="height:auto;">
<div class="collage" id="collage">
<canvas id="canvas" width="900" height="600" style="cursor: pointer;border:1px solid #ccc;"></canvas>
<img id="imagePreview" class="imagbox" src="" alt="Image Preview">
</div>
<br>
<b style="text-align: center;">–†–æ–∑–º—ñ—Ä</b>
<br>
<input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1" style="cursor: pointer;">
<div class="gallery-container">
<div class="gallery-block" id="vowsi">
<b>–§–æ–Ω</b><br /><br />
<div>
<span class="arrow" onclick="prevSlide()">&#10094;</span>
<div class="thumbnails" id="thumbs"></div>
<span class="arrow" onclick="nextSlide()">&#10095;</span>
</div>
</div>
<div class="gallery-block photo-block">
<b>–í–∞—à–µ —Ñ–æ—Ç–æ</b><br /><br />
<div>
<label id="fot" class="disabled" title="–§–æ—Ç–æ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö"></label>
</div>
</div>
</div>
<div class="gallery-container vows" id="vowse" style="display:none;">
<div class="gallery-block">
<div class="labels">
<span class="label1">–ù–∞–¥–ø–∏—Å</span>
<span class="label2">–ö–ª—è—Ç–≤–∞ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö</span>
</div>
<div class="gallery-row">
<span class="arow" onclick="prevVow()">&#10094;</span>
<div class="thumbnails" id="thumbsVows"></div>
<span class="arow" onclick="nextVow()">&#10095;</span>
</div>
</div>
</div>
<p class="button-row">
<button id="undoBtn" type="button">‚ü≤ Undo</button>
<button id="previewBtn" type="button" class="disabled">üëÅ –ü–µ—Ä–µ–≥–ª—è–¥</button>
<button id="downloadBtn" type="button" style="display:none;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
<button id="updateBtn" type="button">UPDATE</button>
</p>
<br>
</fieldset>
<a href="https://intuit-portal.blogspot.com/p/donate.html" class="donate-btn" target="_blank" title="–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç">‚ù§Ô∏è</a>
<input type="file" id="bgLoader" style="display:none">
<input type="file" id="loveLoader" style="display:none">

<script>
// ======= Collage JS =======

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');
const thumbsVows = document.getElementById('thumbsVows');
const loveLoader = document.getElementById('loveLoader');
const scaleSlider = document.getElementById('scaleSlider');
const undoBtn = document.getElementById('undoBtn');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const bgLoader = document.getElementById('bgLoader');
const collage = document.getElementById('collage');
const vowse = document.getElementById('vowse');
const vowsi = document.getElementById('vowsi');
const photoBlock = document.querySelector('.photo-block');
const imagePreview = document.getElementById('imagePreview');

const url = "https://detectfraud.github.io/gallery/";
const images = [ "nature1","nature2","nature3","nature(4)","nature(5)","nature(6)","nature(7)","nature(8)","nature(9)","Fon" ];
const fullImages = images.map(name => url + name + ".jpeg");
let startIndex = 0;
const vows = ["Eternity","Fidelity","Joy","Love","Strength","Tenderness","Trust","Unity","Heart","Hearts"];
const fullVows = vows.map(name => url + name + ".png");
let vowIndex = 0;
const lovestoneImages = ["LoveStones"];
const fullLovestones = lovestoneImages.map(name => url + name + ".png");
let lovestoneIndex = 0;
let activeThumb = { bg: null, vow: null };

let layers={
    bg:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
    love:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
    vow:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
    lovestone:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1}
};
let activeLayer=null, previewMode=false;
const history=[]; const MAX_HISTORY=20;

function makeSnapshot(){ return { bg:{...layers.bg}, love:{...layers.love}, vow:{...layers.vow}, lovestone:{...layers.lovestone}, previewMode, activeLayer, activeThumbBg: activeThumb.bg, activeThumbVow: activeThumb.vow }; }
function pushHistory(){ history.push(makeSnapshot()); if(history.length>MAX_HISTORY) history.shift(); }
function applySnapshot(s){ 
    previewMode=!!s.previewMode; activeLayer=s.activeLayer||null;
    ['bg','love','vow','lovestone'].forEach(key=>{
        const v=s[key];
        if(v && v.src){
            const img=new Image();
            img.onload=()=>{ layers[key].img=img; layers[key].src=v.src; drawAll(); };
            img.src=v.src;
        } else { layers[key].img=null; layers[key].src=null; layers[key].x=v? v.x:canvas.width/2; layers[key].y=v? v.y:canvas.height/2; layers[key].scale=v? v.scale:1; }
    });
    // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –º—ñ–Ω—ñ–∞—Ç—é—Ä
    setTimeout(()=>{
        if(s.activeThumbBg){
            const reRenderedActiveThumb = Array.from(thumbs.querySelectorAll('.thumb')).find(t => t.src===s.activeThumbBg.src);
            if(reRenderedActiveThumb){ reRenderedActiveThumb.classList.add('active'); if(s.activeThumbBg.imgName!=="Fon"){ reRenderedActiveThumb.classList.add('disabled'); } activeThumb.bg=s.activeThumbBg; }
        }
        if(s.activeThumbVow){
            const reRenderedActiveThumb = Array.from(thumbsVows.querySelectorAll('.thumb')).find(t => t.src===s.activeThumbVow.src);
            if(reRenderedActiveThumb){ reRenderedActiveThumb.classList.add('active'); reRenderedActiveThumb.classList.add('disabled'); activeThumb.vow=s.activeThumbVow; }
        }
    },100);
    toggleButtons();
}

function drawLayerTo(ctxTarget,layer){ if(!layer||!layer.img)return; const w=layer.img.width*layer.scale; const h=layer.img.height*layer.scale; const x=layer.x; const y=layer.y; ctxTarget.drawImage(layer.img,x-w/2,y-h/2,w,h); }
function drawAll(){ ctx.clearRect(0,0,canvas.width,canvas.height); drawLayerTo(ctx,layers.bg); drawLayerTo(ctx,layers.love); drawLayerTo(ctx,layers.vow); drawLayerTo(ctx,layers.lovestone); }

function toggleButtons(){ if(previewMode){ previewBtn.style.display='none'; downloadBtn.style.display='inline-block'; canvas.classList.add('preview-zoom-in'); activeLayer=null; } else { previewBtn.style.display='inline-block'; downloadBtn.style.display='none'; canvas.classList.remove('preview-zoom-in'); } }

scaleSlider.addEventListener('input',()=>{ if(!activeLayer) return; layers[activeLayer].scale=parseFloat(scaleSlider.value); drawAll(); });

let dragging=false, dragStartX=0, dragStartY=0;
canvas.addEventListener('mousedown',e=>{ if(previewMode || !activeLayer)return; dragging=true; dragStartX=e.offsetX-layers[activeLayer].x; dragStartY=e.offsetY-layers[activeLayer].y; });
canvas.addEventListener('mousemove',e=>{ if(!dragging || previewMode || !activeLayer) return; layers[activeLayer].x=e.offsetX-dragStartX; layers[activeLayer].y=e.offsetY-dragStartY; drawAll(); });
canvas.addEventListener('mouseup',()=>{ if(dragging){ dragging=false; pushHistory(); } });
canvas.addEventListener('mouseleave',()=>{ if(dragging){ dragging=false; pushHistory(); } });
canvas.addEventListener('touchstart',e=>{ if(previewMode || !activeLayer)return; const touch=e.touches[0]; dragging=true; const rect=canvas.getBoundingClientRect(); dragStartX=touch.clientX-rect.left-layers[activeLayer].x; dragStartY=touch.clientY-rect.top-layers[activeLayer].y; });
canvas.addEventListener('touchmove',e=>{ if(!dragging || previewMode || !activeLayer) return; const touch=e.touches[0]; const rect=canvas.getBoundingClientRect(); layers[activeLayer].x=touch.clientX-rect.left-dragStartX; layers[activeLayer].y=touch.clientY-rect.top-dragStartY; drawAll(); e.preventDefault(); }, {passive:false});
canvas.addEventListener('touchend',()=>{ if(dragging){ dragging=false; pushHistory(); } });

undoBtn.addEventListener('click',()=>{ if(history.length<2) return; history.pop(); applySnapshot(history[history.length-1]); drawAll(); });
previewBtn.addEventListener('click',()=>{ previewMode=true; toggleButtons(); drawAll(); imagePreview.src=canvas.toDataURL(); imagePreview.classList.add('show'); });
downloadBtn.addEventListener('click',()=>{ const a=document.createElement('a'); a.href=canvas.toDataURL('image/png'); a.download='collage.png'; a.click(); });

function createThumb(src, container, layerKey){ const img=new Image(); img.src=src; img.className='thumb'; container.appendChild(img); img.onclick=()=>{ if(activeThumb[layerKey] && activeThumb[layerKey].imgName){ Array.from(container.querySelectorAll('.thumb')).forEach(t=>t.classList.remove('active')); } img.classList.add('active'); activeThumb[layerKey]={src:src,imgName:null}; const l=layers[layerKey]; l.img=new Image(); l.img.onload=()=>{ drawAll(); pushHistory(); }; l.img.src=src; activeLayer=layerKey; scaleSlider.value=l.scale; toggleButtons(); }; }

images.forEach(src=>createThumb(url+src+".jpeg",thumbs,'bg'));
vows.forEach(src=>createThumb(url+src+".png",thumbsVows,'vow'));

</script>
</body>
</html>
