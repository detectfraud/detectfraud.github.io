// --- Drag & Touch (переміщення картинок) ---
let dragging=false, dragStartX=0, dragStartY=0;
canvas.addEventListener('mousedown',e=>{
    if(previewMode || !activeLayer) return; // Відключаємо перетягування у режимі перегляду
    dragging=true;
    dragStartX=e.offsetX-layers[activeLayer].x;
    dragStartY=e.offsetY-layers[activeLayer].y;
});
canvas.addEventListener('mousemove',e=>{
    if(!dragging || previewMode || !activeLayer) return; // Відключаємо перетягування у режимі перегляду
    layers[activeLayer].x=e.offsetX-dragStartX;
    layers[activeLayer].y=e.offsetY-dragStartY;
    drawAll();
});
function stopDrag(){
    if(dragging){ dragging=false; pushHistory(); }
}
canvas.addEventListener('mouseup',stopDrag);
canvas.addEventListener('mouseleave',stopDrag);
canvas.addEventListener('touchstart',e=>{
    if(previewMode || !activeLayer) return; // Відключаємо перетягування у режимі перегляду
    const t=e.touches[0],rect=canvas.getBoundingClientRect();
    dragging=true;
    dragStartX=(t.clientX-rect.left) * (canvas.width/rect.width) - layers[activeLayer].x;
    dragStartY=(t.clientY-rect.top) * (canvas.height/rect.height) - layers[activeLayer].y;
    e.preventDefault();
});
canvas.addEventListener('touchmove',e=>{
    if(!dragging || previewMode || !activeLayer) return; // Відключаємо перетягування у режимі перегляду
    const t=e.touches[0],rect=canvas.getBoundingClientRect();
    layers[activeLayer].x=(t.clientX-rect.left) * (canvas.width/rect.width) - dragStartX;
    layers[activeLayer].y=(t.clientY-rect.top) * (canvas.height/rect.height) - dragStartY;
    drawAll();
    e.preventDefault();
});
canvas.addEventListener('touchend',stopDrag);
