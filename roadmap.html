<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ö–∞–º—ñ–Ω—å –ª—é–±–æ–≤—ñ ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<style>
body { font-family: sans-serif; text-align: center; background: transparent; margin:0; padding:0; }
.venwin { border-radius: 10px; display: inline-block; background-color: rgba(255,255,255,0.5); padding: 20px; box-sizing: border-box; border-color:transparent; }
canvas { border: 3px solid #bbb; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,.1); display: block; margin: 10px auto; transition: transform 0.3s ease-in-out; cursor:pointer; }
.preview-zoom-in:hover { transform: scale(1.43); }
#scaleSlider { width: 420px; cursor:pointer; }
button { padding: 8px 12px; cursor: pointer; border-radius: 8px; }
.disabled { pointer-events:none; opacity:.5; filter: grayscale(100%); }
.gallery-container { display:flex; align-items:flex-start; justify-content:center; gap:10px; margin-top:10px; flex-wrap:wrap; }
.gallery-block { display:flex; flex-direction:column; align-items:center; gap:10px; }
.gallery-block > div { display:flex; align-items:center; justify-content:center; }
.arrow, .arow { font-size:20px; cursor:pointer; user-select:none; padding:3px; display:flex; align-items:center; justify-content:center; }
.thumbnails { display:flex; gap:10px; overflow-x:auto; justify-content:center; flex-wrap:nowrap; }
.thumb-wrapper { position:relative; }
.thumb { width:108px; height:72px; object-fit:cover; cursor:pointer; box-shadow:0 0 6px rgba(0,0,0,0.3); transition:all 0.3s ease; border-radius:10px; flex-shrink:0; }
.thumb.active { border:3px solid red; box-shadow:0 0 10px red; }
.collage { position:relative; display:inline-block; margin-top:0; }
.button-row { display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; }
.imagbox { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.1); width:825px; height:510px; opacity:0; transition:all 0.9s ease; z-index:9999; border-radius:12px; box-shadow:0 0 25px rgba(0,0,0,0.7); pointer-events:none; background:#fff; }
.imagbox.show { opacity:1; transform:translate(-50%,-50%) scale(0.6); }
.donate-btn { position:fixed; bottom:30px; right:50%; background-color:#e74c3c; color:white; border-radius:50%; width:50px; height:50px; display:flex; align-items:center; justify-content:center; font-size:28px; text-decoration:none; box-shadow:0 4px 10px rgba(0,0,0,0.2); cursor:pointer; z-index:1000; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%{transform:scale(1);}50%{transform:scale(1.1);}100%{transform:scale(1);} }

@media (max-width: 768px) {
    .venwin { padding:10px; }
    canvas { width:95%; height:auto; }
    #scaleSlider { width:95%; }
    .gallery-container { flex-direction:column; align-items:center; }
    .thumbnails { width:95%; }
    .button-row button { padding:12px 16px; font-size:16px; }
    .donate-btn { bottom:10px; right:10px; width:40px; height:40px; font-size:22px; }
}
</style>
</head>
<body>
<fieldset class="venwin" style="height:auto;">
<div class="collage" id="collage">
    <canvas id="canvas" width="900" height="600"></canvas>
    <img id="imagePreview" class="imagbox" src="" alt="Image Preview">
</div>
<br>
<b>–†–æ–∑–º—ñ—Ä</b><br>
<input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1">
<div class="gallery-container">
    <div class="gallery-block" id="vowsi">
        <b>–§–æ–Ω</b><br><br>
        <div>
            <span class="arrow" onclick="prevSlide()">&#10094;</span>
            <div class="thumbnails" id="thumbs"></div>
            <span class="arrow" onclick="nextSlide()">&#10095;</span>
        </div>
    </div>
    <div class="gallery-block photo-block">
        <b>–í–∞—à–µ —Ñ–æ—Ç–æ</b><br><br>
        <div>
            <label id="fot" class="disabled" title="–§–æ—Ç–æ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö"></label>
        </div>
    </div>
</div>
<div class="gallery-container vows" id="vowse" style="display:none;">
    <div class="gallery-block">
        <div class="labels">
            <span class="label1">–ù–∞–¥–ø–∏—Å</span>
            <span class="label2">–ö–ª—è—Ç–≤–∞ –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö</span>
        </div>
        <div class="gallery-row">
            <span class="arow" onclick="prevVow()">&#10094;</span>
            <div class="thumbnails" id="thumbsVows"></div>
            <span class="arow" onclick="nextVow()">&#10095;</span>
        </div>
    </div>
</div>
<p class="button-row">
    <button id="undoBtn" type="button">‚ü≤ Undo</button>
    <button id="previewBtn" type="button" class="disabled">üëÅ –ü–µ—Ä–µ–≥–ª—è–¥</button>
    <button id="downloadBtn" type="button" style="display:none;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
    <button id="updateBtn" type="button">UPDATE</button>
</p>
</fieldset>
<a href="https://intuit-portal.blogspot.com/p/donate.html" class="donate-btn" target="_blank" title="–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç">‚ù§Ô∏è</a>
<input type="file" id="bgLoader" style="display:none">
<input type="file" id="loveLoader" style="display:none">

<script>
/* === Collage JS (–∞–¥–∞–ø—Ç–æ–≤–∞–Ω–æ –¥–ª—è iframe + touch) === */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const collage = document.getElementById('collage');
const scaleSlider = document.getElementById('scaleSlider');

function resizeCanvas() {
    const containerWidth = collage.offsetWidth;
    canvas.width = containerWidth;
    canvas.height = containerWidth * 0.66; // –ü—Ä–æ–ø–æ—Ä—Ü—ñ—ó 900x600
    drawAll();
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Touch & drag
let activeLayer=null, previewMode=false, dragging=false, dragStartX=0, dragStartY=0;
canvas.addEventListener('touchstart', e=>{
    if(!activeLayer || previewMode) return;
    const t=e.touches[0], rect=canvas.getBoundingClientRect();
    dragging=true;
    dragStartX=(t.clientX-rect.left)*(canvas.width/rect.width)-layers[activeLayer].x;
    dragStartY=(t.clientY-rect.top)*(canvas.height/rect.height)-layers[activeLayer].y;
    e.preventDefault();
});
canvas.addEventListener('touchmove', e=>{
    if(!dragging || !activeLayer || previewMode) return;
    const t=e.touches[0], rect=canvas.getBoundingClientRect();
    layers[activeLayer].x=(t.clientX-rect.left)*(canvas.width/rect.width)-dragStartX;
    layers[activeLayer].y=(t.clientY-rect.top)*(canvas.height/rect.height)-dragStartY;
    drawAll();
    e.preventDefault();
});
canvas.addEventListener('touchend', ()=>{ if(dragging){ dragging=false; pushHistory(); }});

// –ú–∞—Å—à—Ç–∞–± slider
scaleSlider.addEventListener('input', ()=>{
    if(!activeLayer) return;
    layers[activeLayer].scale=parseFloat(scaleSlider.value);
    drawAll();
});

// –ó–∞–±–æ—Ä–æ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
document.oncontextmenu = document.onselectstart = document.ondragstart = ()=>false;

/* === –¢–≤–æ—ó –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó renderThumbnails, renderVows, drawAll, handleFileLoad —Ç–æ—â–æ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω === */

</script>
</body>
</html>
