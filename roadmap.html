<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>ĞšĞ°Ğ¼Ñ–Ğ½ÑŒ Ğ»ÑĞ±Ğ¾Ğ²Ñ– â€” Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€</title>
<style>Â  Â Â 
body { font-family: sans-serif; text-align: center; background: url(images/unamed.jpg) repeat scroll top left; }
.venwin { border-radius: 10px; display: inline-block; background-color: rgba(255, 255, 255, 0.5); padding: 20px 20px; box-sizing: border-box;}
/* Ğ—Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾ CSS Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ ĞºĞ°Ğ½Ğ²Ğ°ÑÑƒ Ğ¼ĞµĞ½ÑˆĞ¸Ğ¼, Ğ½Ñ–Ğ¶ Ğ¹Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ€ */
canvas {Â 
Â  Â  border: 3px solid #bbb;Â 
Â  Â  border-radius: 6px;Â 
Â  Â  box-shadow: 0 6px 18px rgba(0,0,0,.1);Â 
Â  Â  display: block;Â 
Â  Â  margin: 10px auto;Â 
Â  Â  width: 630px; /* Ğ’Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ÑƒĞ²Ğ°Ğ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ€ */
Â  Â  height: 420px; /* Ğ’Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ÑƒĞ²Ğ°Ğ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ€ */
Â  transition: transform 0.3s ease-in-out;
Â  transform-origin: center center;
Â  cursor:pointer;
Â  position: relative; /* Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ñ†Ğµ! */
Â  z-index: 10;
}
.preview-zoom-in:hover {
Â  Â  transform: scale(1.43);
}
Â  Â Â 
#scaleSlider { width: 420px; } /* ĞĞ´Ğ°Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ´Ğ¾ ÑˆĞ¸Ñ€Ğ¸Ğ½Ğ¸ ĞºĞ°Ğ½Ğ²Ğ°ÑÑƒ */
button { padding: 8px 12px; cursor: pointer; border-radius: 8px; }
.disabled { pointer-events: none; opacity: .5; filter: grayscale(100%); }
.gallery-container { display: flex; align-items: flex-start; justify-content: center; gap: 10px; margin-top: 10px; }
.gallery-block { display: flex; flex-direction: column; align-items: center; gap: 10px; }
.gallery-block > div { display: flex; align-items: center; justify-content: center;}
.arrow, .arow { font-size: 20px; cursor: pointer; user-select: none; padding: 3px; line-height: 1; display: flex; align-items: center; justify-content: center; }
.arrow:first-child { margin-right: -130px; }
.arrow:last-child { margin-left: -130px; }
.arow:first-child { margin-right: -60px; }
.arow:last-child { margin-left: -60px; }
.thumbnails { display: flex; gap: 10px; overflow: hidden; width: 630px; justify-content: center; }
.thumb-wrapper { position: relative; }
.thumb { width: 108px; height: 72px; object-fit: cover; cursor: pointer; box-shadow: 0 0 6px rgba(0,0,0,0.3); transition: all 0.3s ease; z-index: 1; border-radius: 10px; }
/* Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾ Ğ½Ğ¾Ğ²Ğ¸Ğ¹ ÑÑ‚Ğ¸Ğ»ÑŒ Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ñ—/Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾Ñ— Ğ¼Ñ–Ğ½Ñ–Ğ°Ñ‚ÑÑ€Ğ¸ */
.thumb.active { border: 3px solid red; box-shadow: 0 0 10px red; }
.collage {
Â  Â  position: relative;
Â  Â  display: inline-block;
Â  Â  margin-top: 0;
}
.gallery-container.vows .labels { display: grid; grid-template-columns: repeat(4, 1fr); text-align: center; margin-bottom: 5px; }
.gallery-container.vows .labels .label1 { grid-column: 1; font-weight: bold; margin-left: 70px; }
.gallery-container.vows .labels .label2 { grid-column: 3; font-weight: bold; }
.arrow, .arow { position: relative; z-index: 3; }
.button-row { display: flex; justify-content: center; align-items: center; gap: 10px; }

#fot { display: inline-block; cursor: pointer; border-radius: 8px; width: 108px; height: 72px; background-image: url(https://detectfraud.github.io/gallery/Para.png); background-repeat: no-repeat; background-size: contain; }
#fot:hover { mix-blend-mode: luminosity; }
#fot:active { mix-blend-mode: exclusion; }

/* Ğ—Ğ¼Ñ–Ğ½Ğ¸ Ğ² ÑÑ‚Ğ¸Ğ»ÑÑ… imagbox */
.imagbox {
Â  Â  position: absolute;
Â  Â  top: 50%;
Â  Â  left: 50%;
Â  Â  transform: translate(-50%,-50%) scale(0.1);
Â  Â  width: 825px;
Â  Â  height: 510px;
Â  Â  opacity: 0;
Â  Â  transition: all 0.9s ease;
Â  Â  z-index: 9999;
Â  Â  border-radius: 12px;
Â  Â  box-shadow: 0 0 25px rgba(0,0,0,0.7);
Â  Â  pointer-events: none;
Â  Â  background: #fff;
}
.imagbox.show {
Â  Â  opacity: 1;
Â  Â  transform: translate(-50%,-50%) scale(0.6);
}

.photo-block { margin-left: 100px; }
#updateBtn { margin-left: 300px; font-weight: bold; color: red; }

/* ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ´Ğ¾Ğ½Ğ°Ñ‚Ñƒ */
.donate-btn {
Â  Â  position: fixed;
Â  Â  bottom: 20px;
Â  Â  right: 20px;
Â  Â  background-color: #e74c3c;
Â  Â  color: white;
Â  Â  border-radius: 50%;
Â  Â  width: 60px;
Â  Â  height: 60px;
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  font-size: 28px;
Â  Â  text-decoration: none;
Â  Â  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
Â  Â  cursor: pointer;
Â  Â  z-index: 1000;
Â  Â  animation: pulse 1.5s infinite;
}

@keyframes pulse {
Â  Â  0% { transform: scale(1); }
Â  Â  50% { transform: scale(1.1); }
Â  Â  100% { transform: scale(1); }
}

/* ĞĞ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ñ–Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒĞ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸ÑÑ‚Ñ€Ğ¾Ñ—Ğ² */
@media (max-width: 768px) {
Â  Â  .venwin { padding: 10px; }
Â  Â  canvas { width: 95%; height: auto; }
Â  Â  #scaleSlider { width: 95%; }
Â  Â  .gallery-container { flex-direction: column; align-items: center; }
Â  Â  .thumbnails { width: 100%; justify-content: center; }
Â  Â  .arrow:first-child, .arrow:last-child { margin: 0 10px; }
Â  Â  .arow:first-child, .arow:last-child { margin: 0 10px; }
Â  Â  .photo-block { margin-left: 0; }
Â  Â  #updateBtn { margin-left: 0; margin-top: 10px; }
Â  Â  .gallery-container.vows .labels { grid-template-columns: 1fr 1fr; }
Â  Â  .gallery-container.vows .labels .label1, .gallery-container.vows .labels .label2 { margin: 0; }
Â  Â  .donate-btn { bottom: 10px; right: 10px; width: 50px; height: 50px; font-size: 24px; }
}
</style>
</head>
<body>

<fieldset class="venwin" style="height:auto;">
<div class="collage" id="collage">
Â  Â  <canvas id="canvas" width="900" height="600" style="cursor: pointer;border:1px solid #ccc;"></canvas>
Â  Â  <img id="imagePreview" class="imagbox" src="" alt="Image Preview">
</div>
<br><b style="text-align: center;">Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€</b>
<br><input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1" style="cursor: pointer;">
<div class="gallery-container">
Â  Â  <div class="gallery-block" id="vowsi">
Â  Â  Â  Â  <b>Ğ¤Ğ¾Ğ½</b><br /><br />
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <span class="arrow" onclick="prevSlide()">&#10094;</span>
Â  Â  Â  Â  Â  Â  <div class="thumbnails" id="thumbs"></div>
Â  Â  Â  Â  Â  Â  <span class="arrow" onclick="nextSlide()">&#10095;</span>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="gallery-block photo-block">
Â  Â  Â  Â  <b>Ğ’Ğ°ÑˆĞµ Ñ„Ğ¾Ñ‚Ğ¾</b><br /><br />
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label id="fot" class="disabled" title="Ğ¤Ğ¾Ñ‚Ğ¾ Ğ·Ğ°ĞºĞ¾Ñ…Ğ°Ğ½Ğ¸Ñ…"></label>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div class="gallery-container vows" id="vowse" style="display:none;">
Â  Â  <div class="gallery-block">
Â  Â  Â  Â  <div class="labels">
Â  Â  Â  Â  Â  Â  <span class="label1">ĞĞ°Ğ´Ğ¿Ğ¸Ñ</span>
Â  Â  Â  Â  Â  Â  <span class="label2">ĞšĞ»ÑÑ‚Ğ²Ğ° Ğ·Ğ°ĞºĞ¾Ñ…Ğ°Ğ½Ğ¸Ñ…</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="gallery-row">
Â  Â  Â  Â  Â  Â  <span class="arow" onclick="prevVow()">&#10094;</span>
Â  Â  Â  Â  Â  Â  <div class="thumbnails" id="thumbsVows"></div>
Â  Â  Â  Â  Â  Â  <span class="arow" onclick="nextVow()">&#10095;</span>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<p class="button-row">
Â  Â  <button id="undoBtn" type="button">âŸ² Undo</button>
Â  Â  <button id="previewBtn" type="button" class="disabled">ğŸ‘ ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´</button>
Â  Â  <button id="downloadBtn" type="button" style="display:none;">ğŸ“¥ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸</button>
Â  Â  <button id="updateBtn" type="button">UPDATE</button>
</p><br>
</fieldset>
<a href="https://example.com/donate" class="donate-btn" target="_blank" title="ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ñ”ĞºÑ‚">â¤ï¸</a>
<input type="file" id="bgLoader" style="display:none">
<input type="file" id="loveLoader" style="display:none">
<script>
/* === Collage JS === */

// ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½ÑŒ Ğ½Ğ° DOM-ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¸
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');
const thumbsVows = document.getElementById('thumbsVows');
const loveLoader = document.getElementById('loveLoader');
const scaleSlider = document.getElementById('scaleSlider');
const undoBtn = document.getElementById('undoBtn');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const bgLoader = document.getElementById('bgLoader');
const collage = document.getElementById('collage');
const vowse = document.getElementById('vowse');
const vowsi = document.getElementById('vowsi');
const photoBlock = document.querySelector('.photo-block');
const loveStoneName = "LoveStones";
const DONATE_URL = "https://example.com/donate";
const imagePreview = document.getElementById('imagePreview'); // ĞĞ¾Ğ²Ğ¸Ğ¹ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ¿Ñ€ĞµĞ²'Ñ

// --- Ğ”Ğ°Ğ½Ñ– Ñ‚Ğ° Ğ³Ğ°Ğ»ĞµÑ€ĞµÑ— ---
const url = "https://detectfraud.github.io/gallery/";
const images = [ "nature(1)","nature(2)","nature(3)","nature(4)","nature(5)",
"nature(6)","nature(7)","nature(8)","nature(9)","Fon" ];
const fullImages = images.map(name => url + name + ".jpeg");
let startIndex = 0;

const vows = ["Eternity","Fidelity","Joy","Love","Strength","Tenderness","Trust","Unity","Heart","Hearts"];
const fullVows = vows.map(name => url + name + ".png");
let vowIndex = 0;

const lovestoneImages = ["LoveStones"];
const fullLovestones = lovestoneImages.map(name => url + name + ".png");
let lovestoneIndex = 0;

// Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ” Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ñƒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñƒ Ğ¼Ñ–Ğ½Ñ–Ğ°Ñ‚ÑÑ€Ñƒ
let activeThumb = null;

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ Ğ´Ğ»Ñ Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ñ— Ğ¼Ñ–Ğ½Ñ–Ğ°Ñ‚ÑÑ€Ğ¸
function setActiveThumb(thumbElement) {
Â  Â  if (activeThumb) {
Â  Â  Â  Â  activeThumb.classList.remove('active');
Â  Â  }
Â  Â  thumbElement.classList.add('active');
Â  Â  activeThumb = thumbElement;
}

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ñƒ Ğ¿Ñ€ĞµĞ²'Ñ Ğ´Ğ»Ñ Ñ„Ğ¾Ğ½Ñ–Ğ²
function renderThumbnails() {
Â  Â  thumbs.innerHTML = "";
Â  Â  activeThumb = null; // ĞÑ‡Ğ¸Ñ‰ÑƒÑ”Ğ¼Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ¿Ñ€Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ñ– ÑĞ»Ğ°Ğ¹Ğ´Ñƒ
Â  Â  fullImages.slice(startIndex, startIndex + 3).forEach(src => createThumb(src, thumbs, 'bg'));
}

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ñƒ Ğ¿Ñ€ĞµĞ²'Ñ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‚Ğ² Ñ‚Ğ° Ğ½Ğ°Ğ´Ğ¿Ğ¸ÑÑ–Ğ²
function renderVows() {
Â  Â  thumbsVows.innerHTML = "";
Â  Â  activeThumb = null; // ĞÑ‡Ğ¸Ñ‰ÑƒÑ”Ğ¼Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ¿Ñ€Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ñ– ÑĞ»Ğ°Ğ¹Ğ´Ñƒ
Â  Â  // Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ¼Ğ¾ Ğ½Ğ°Ğ´Ğ¿Ğ¸Ñ Ğ¾ĞºÑ€ĞµĞ¼Ğ¾
Â  Â  fullLovestones.slice(lovestoneIndex, lovestoneIndex + 1).forEach(src => createThumb(src, thumbsVows, 'lovestone'));
Â  Â  // Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ¼Ğ¾ ĞºĞ»ÑÑ‚Ğ²Ğ¸
Â  Â  fullVows.slice(vowIndex, vowIndex + 3).forEach(src => createThumb(src, thumbsVows, 'vow'));
}

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ¿Ñ€ĞµĞ²'Ñ-ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¸
function createThumb(src, container, key) {
Â  Â  const wrapper = document.createElement("div");
Â  Â  wrapper.className = "thumb-wrapper";
Â  Â  const imgName = src.split("/").pop().split(".")[0];
Â  Â  const thumb = document.createElement("img");
Â  Â  thumb.className = "thumb";
Â  Â  thumb.src = src;

Â  Â  // Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ğ·Ğ°Ñ‚Ñ€Ğ¸Ğ¼ĞºÑƒ
Â  Â  let timer;
Â  Â  wrapper.addEventListener('mouseenter', () => {
Â  Â  Â  Â  timer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  imagePreview.src = src; // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ src Ñ”Ğ´Ğ¸Ğ½Ğ¾Ğ³Ğ¾ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ¿Ñ€ĞµĞ²'Ñ
Â  Â  Â  Â  Â  Â  imagePreview.classList.add('show');
Â  Â  Â  Â  }, 700);
Â  Â  });
Â  Â  wrapper.addEventListener('mouseleave', () => {
Â  Â  Â  Â  clearTimeout(timer);
Â  Â  Â  Â  imagePreview.classList.remove('show');
Â  Â  });

Â  Â  if (imgName === "Fon") {
Â  Â  Â  Â  thumb.title = "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ ÑĞ²Ñ–Ğ¹ Ñ„Ğ¾Ğ½";
Â  Â  Â  Â  thumb.onclick = () => {
Â  Â  Â  Â  Â  Â  bgLoader.click();
Â  Â  Â  Â  Â  Â  imagePreview.classList.remove('show'); // ĞŸÑ€Ğ¸Ñ…Ğ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ñ€ĞµĞ²'Ñ
Â  Â  Â  Â  };
Â  Â  } else {
Â  Â  Â  Â  thumb.onclick = () => {
Â  Â  Â  Â  Â  Â  handleFileFromGallery(src, key);
Â  Â  Â  Â  Â  Â  if (key === 'bg') {
Â  Â  Â  Â  Â  Â  Â  Â  setActiveThumb(thumb);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  }

Â  Â  wrapper.appendChild(thumb);
Â  Â  container.appendChild(wrapper);
}

// Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ— Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¸ Ğ³Ğ°Ğ»ĞµÑ€ĞµĞ¹
function prevSlide(){
Â  Â  startIndex=(startIndex-3+fullImages.length)%fullImages.length;
Â  Â  renderThumbnails();
}
function nextSlide(){
Â  Â  startIndex=(startIndex+3)%fullImages.length;
Â  Â  renderThumbnails();
}
function prevVow(){ vowIndex=(vowIndex-3+fullVows.length)%fullVows.length; renderVows(); }
function nextVow(){ vowIndex=(vowIndex+3)%fullVows.length; renderVows(); }

// Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ· Ğ³Ğ°Ğ»ĞµÑ€ĞµÑ— Ğ½Ğ° Canvas
function handleFileFromGallery(src, key){
Â  Â  // --- ĞĞĞ’Ğ† Ğ Ğ¯Ğ”ĞšĞ˜ ĞšĞĞ”Ğ£ ---
Â  Â  // Ğ’Ğ¸Ğ¼Ğ¸ĞºĞ°Ñ”Ğ¼Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ, ÑĞºÑ‰Ğ¾ Ğ²Ñ–Ğ½ Ğ±ÑƒĞ² ÑƒĞ²Ñ–Ğ¼ĞºĞ½ĞµĞ½Ğ¸Ğ¹
Â  Â  if (previewMode) {
Â  Â  Â  Â  previewMode = false;
Â  Â  Â  Â  toggleButtons();
Â  Â  }
Â  Â  // --- ĞšĞ†ĞĞ•Ğ¦Ğ¬ ĞĞĞ’Ğ˜Ğ¥ Ğ Ğ¯Ğ”ĞšĞ†Ğ’ ---

Â  Â  imagePreview.classList.remove('show'); // Ğ’Ğ¸Ğ´Ğ°Ğ»ÑÑ”Ğ¼Ğ¾ ĞºĞ»Ğ°Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ²ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¿Ñ€ĞµĞ²'Ñ
Â  Â  const img = new Image();
Â  Â  img.crossOrigin = "anonymous";
Â  Â  img.onload = () => {
Â  Â  Â  Â  layers[key].img = img;
Â  Â  Â  Â  layers[key].src = src;

Â  Â  Â  Â  if (key === 'vow') {
Â  Â  Â  Â  Â  Â  layers[key].scale = 0.5;
Â  Â  Â  Â  Â  Â  layers[key].x = (img.width * layers[key].scale / 2) + 14.28; // ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ²Ğ°Ğ½Ğ¾
Â  Â  Â  Â  Â  Â  layers[key].y = canvas.height - (img.height * layers[key].scale / 2) - 14.28; // ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ²Ğ°Ğ½Ğ¾
Â  Â  Â  Â  } else if (key === 'lovestone') {
Â  Â  Â  Â  Â  Â  layers[key].scale = 0.5;
Â  Â  Â  Â  Â  Â  layers[key].x = canvas.width / 2;
Â  Â  Â  Â  Â  Â  layers[key].y = canvas.height / 2;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  layers[key].x = canvas.width / 2;
Â  Â  Â  Â  Â  Â  layers[key].y = canvas.height / 2;
Â  Â  Â  Â  Â  Â  layers[key].scale = 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  activeLayer = key;
Â  Â  Â  Â  if (activeLayer) {
Â  Â  Â  Â  Â  Â  scaleSlider.value = layers[activeLayer].scale;
Â  Â  Â  Â  }
Â  Â  Â  Â  scaleSlider.disabled = false;
Â  Â  Â  Â  scaleSlider.classList.remove('disabled');
Â  Â  Â  Â  pushHistory();
Â  Â  Â  Â  drawAll();

Â  Â  Â  Â  // Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ÑÑ‚Ğ°Ğ½Ğ¾Ğ¼ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
Â  Â  Â  Â  if (key === 'bg') {
Â  Â  Â  Â  Â  Â  document.getElementById('fot').classList.remove('disabled');
Â  Â  Â  Â  }
Â  Â  Â  Â  if (key === 'love' || key === 'lovestone') {
Â  Â  Â  Â  Â  Â  document.getElementById('previewBtn').classList.remove('disabled');
Â  Â  Â  Â  }

Â  Â  Â  Â  previewBtn.style.display = 'inline-block';
Â  Â  Â  Â  downloadBtn.style.display = 'none';
Â  Â  };
Â  Â  img.src = src;
}

// Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ„Ğ¾Ñ‚Ğ¾/Ñ„Ğ¾Ğ½Ñ–Ğ² Ğ· Ñ„Ğ°Ğ¹Ğ»Ñƒ
function handleFileLoad(file,key){
Â  Â  if(!file) return;
Â  Â  const reader=new FileReader();
Â  Â  reader.onload=e=>{
Â  Â  Â  Â  const data=e.target.result;
Â  Â  Â  Â  const img=new Image();
Â  Â  Â  Â  img.onload=()=>{
Â  Â  Â  Â  Â  Â  layers[key].img=img;
Â  Â  Â  Â  Â  Â  layers[key].src=data;
Â  Â  Â  Â  Â  Â  layers[key].x = canvas.width / 2;
Â  Â  Â  Â  Â  Â  layers[key].y = canvas.height / 2;
Â  Â  Â  Â  Â  Â  layers[key].scale = 1;
Â  Â  Â  Â  Â  Â  activeLayer = key;
Â  Â  Â  Â  Â  Â  if (activeLayer) {
Â  Â  Â  Â  Â  Â  Â  Â  scaleSlider.value = layers[activeLayer].scale;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  scaleSlider.disabled = false;
Â  Â  Â  Â  Â  Â  scaleSlider.classList.remove('disabled');
Â  Â  Â  Â  Â  Â  pushHistory();
Â  Â  Â  Â  Â  Â  drawAll();
Â  Â  Â  Â  Â  Â  // Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ÑÑ‚Ğ°Ğ½Ğ¾Ğ¼ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
Â  Â  Â  Â  Â  Â  if (key === 'bg') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('fot').classList.remove('disabled');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (key === 'love') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('previewBtn').classList.remove('disabled');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  img.src=data;
Â  Â  };
Â  Â  reader.readAsDataURL(file);
}

// ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´Ñ–Ğ¹ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²
bgLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'bg'));
loveLoader.addEventListener('change',e=>handleFileLoad(e.target.files[0],'love'));
document.getElementById("fot").onclick=()=>loveLoader.click();

// --- Ğ¨Ğ°Ñ€Ğ¸, Ğ¼Ğ°ÑĞºĞ° Ñ‚Ğ° Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ ---
const template=new Image(); template.src='images/composit.png';
// ĞŸĞµÑ€ĞµÑ€Ğ°Ñ…Ğ¾Ğ²Ğ°Ğ½Ñ– ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ğ¸ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ€Ñƒ ĞºĞ°Ğ½Ğ²Ğ°ÑÑƒ 900x600
const HOLE_OFFSET_X=6, HOLE_OFFSET_Y=-115, HOLE_RADIUS=98;
let mask={cx:canvas.width/2+HOLE_OFFSET_X, cy:canvas.height/2+HOLE_OFFSET_Y, r:HOLE_RADIUS};

// ĞĞ¾Ğ²Ñ– Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ²Ñ– ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ğ¸ Ğ´Ğ»Ñ ÑˆĞ°Ñ€Ñ–Ğ²
let layers={
Â  Â  bg:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
Â  Â  love:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
Â  Â  vow:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1},
Â  Â  lovestone:{img:null,src:null,x:canvas.width/2,y:canvas.height/2,scale:1}
};
let activeLayer=null, previewMode=false, bgHoleActive=true;

const history=[]; const MAX_HISTORY=20;
function makeSnapshot(){ return { bg:{...layers.bg}, love:{...layers.love}, loveScale: scaleSlider.value, vow:{...layers.vow}, lovestone:{...layers.lovestone}, previewMode, activeLayer, bgHoleActive }; }
function pushHistory(){ history.push(makeSnapshot()); if(history.length>MAX_HISTORY) history.shift(); }
function applySnapshot(s){
Â  Â  previewMode=!!s.previewMode; activeLayer=s.activeLayer||null; bgHoleActive=!!s.bgHoleActive;
Â  Â Â 
Â  Â  // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ ÑÑ‚Ğ°Ğ½ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
Â  Â  if (s.bg.img) {
Â  Â  Â  Â  document.getElementById('fot').classList.remove('disabled');
Â  Â  } else {
Â  Â  Â  Â  document.getElementById('fot').classList.add('disabled');
Â  Â  }
Â  Â  if (s.love.img) {
Â  Â  Â  Â  document.getElementById('previewBtn').classList.remove('disabled');
Â  Â  } else {
Â  Â  Â  Â  document.getElementById('previewBtn').classList.add('disabled');
Â  Â  }

Â  Â  ['bg','love','vow','lovestone'].forEach(key=>{
Â  Â  Â  Â  const v=s[key];
Â  Â  Â  Â  if(v && v.src){
Â  Â  Â  Â  Â  Â  const img=new Image();
Â  Â  Â  Â  Â  Â  img.onload=()=>{ layers[key].img=img; layers[key].src=v.src; layers[key].x=v.x; layers[key].y=v.y; layers[key].scale=v.scale; drawAll(); };
Â  Â  Â  Â  Â  Â  img.src=v.src;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  layers[key].img=null; layers[key].src=null;
Â  Â  Â  Â  Â  Â  layers[key].x=v? v.x: canvas.width/2;
Â  Â  Â  Â  Â  Â  layers[key].y=v? v.y: canvas.height/2;
Â  Â  Â  Â  Â  Â  layers[key].scale=v? v.scale:1;
Â  Â  Â  Â  }
Â  Â  });
Â  Â  toggleButtons();
}

// --- Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ— Ğ¼Ğ°Ğ»ÑĞ²Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Canvas ---
// Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ scaleFactor, Ğ¾ÑĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ¼Ğ¸ Ğ±Ñ–Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±ÑƒÑ”Ğ¼Ğ¾ Ğ´Ğ»Ñ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ
function drawLayerTo(ctxTarget, layer){
Â  Â  if(!layer||!layer.img) return;
Â  Â  const w = layer.img.width * layer.scale;
Â  Â  const h = layer.img.height * layer.scale;
Â  Â  const x = layer.x;
Â  Â  const y = layer.y;
Â  Â  ctxTarget.drawImage(layer.img, x - w/2, y - h/2, w, h);
}
function drawLove(ctxTarget, clip=false){
Â  Â  const L=layers.love;
Â  Â  if(!L||!L.img) return;
Â  Â  const w = L.img.width * L.scale;
Â  Â  const h = L.img.height * L.scale;
Â  Â  const x = L.x;
Â  Â  const y = L.y;
Â  Â  ctxTarget.save();
Â  Â  if(clip && mask.r>0){
Â  Â  Â  Â  ctxTarget.beginPath();
Â  Â  Â  Â  ctxTarget.arc(mask.cx, mask.cy, mask.r, 0, Math.PI * 2);
Â  Â  Â  Â  ctxTarget.clip();
Â  Â  }
Â  Â  ctxTarget.drawImage(L.img, x - w/2, y - h/2, w, h);
Â  Â  ctxTarget.restore();
}
function drawBgWithHole(ctxTarget){
Â  Â  if(!layers.bg.img) return;
Â  Â  if(!bgHoleActive||mask.r<=0){ drawLayerTo(ctxTarget,layers.bg); return; }
Â  Â  const off = document.createElement('canvas');
Â  Â  off.width = canvas.width;
Â  Â  off.height = canvas.height;
Â  Â  const octx = off.getContext('2d');
Â  Â  drawLayerTo(octx, layers.bg);
Â  Â  octx.globalCompositeOperation = 'destination-out';
Â  Â  octx.beginPath();
Â  Â  octx.arc(mask.cx, mask.cy, mask.r, 0, Math.PI * 2);
Â  Â  octx.fill();
Â  Â  octx.globalCompositeOperation = 'source-over';
Â  Â  ctxTarget.drawImage(off, 0, 0);
}
function drawAll(){
Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  drawBgWithHole(ctx);
Â  Â  drawLove(ctx, previewMode);
Â  Â  if(template.complete) {
Â  Â  Â  Â  ctx.drawImage(template, 0, 0, canvas.width, canvas.height);
Â  Â  }
Â  Â  drawLayerTo(ctx, layers.vow);
Â  Â  drawLayerTo(ctx, layers.lovestone);
}

// --- ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ñ‚Ğ° Ğ¿ĞµÑ€ĞµĞ¼Ğ¸ĞºĞ°Ğ½Ğ½Ñ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ–Ğ² ---
function toggleButtons(){
Â  Â  if(previewMode){
Â  Â  Â  Â  previewBtn.style.display = 'none';
Â  Â  Â  Â  downloadBtn.style.display = 'inline-block';
Â  Â  Â  Â  if (vowsi) vowsi.style.display = 'none';
Â  Â  Â  Â  if (photoBlock) photoBlock.style.display = 'none';
Â  Â  Â  Â  if (vowse) vowse.style.display = 'inline-block';
Â  Â  Â  Â  canvas.classList.add('preview-zoom-in'); // Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ ĞºĞ»Ğ°Ñ
Â  Â  Â  Â  activeLayer = null;
Â  Â  } else {
Â  Â  Â  Â  previewBtn.style.display = 'inline-block';
Â  Â  Â  Â  downloadBtn.style.display = 'none';
Â  Â  Â  Â  if (vowsi) vowsi.style.display = 'inline-block';
Â  Â  Â  Â  if (photoBlock) photoBlock.style.display = 'inline-block';
Â  Â  Â  Â  if (vowse) vowse.style.display = 'none';
Â  Â  Â  Â  canvas.classList.remove('preview-zoom-in'); // Ğ’Ğ¸Ğ´Ğ°Ğ»ÑÑ”Ğ¼Ğ¾ ĞºĞ»Ğ°Ñ
Â  Â  }
}

// ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾Ğ²Ğ·ÑƒĞ½ĞºĞ° Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±ÑƒĞ²Ğ°Ğ½Ğ½Ñ
scaleSlider.addEventListener('input',()=>{
Â  Â  if(!activeLayer) return;
Â  Â  layers[activeLayer].scale=parseFloat(scaleSlider.value);
Â  Â  drawAll();
});

// --- Drag & Touch (Ğ¿ĞµÑ€ĞµĞ¼Ñ–Ñ‰ĞµĞ½Ğ½Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ¾Ğº) ---
let dragging=false, dragStartX=0, dragStartY=0;
canvas.addEventListener('mousedown',e=>{
Â  Â  if(previewMode || !activeLayer) return; // Ğ’Ñ–Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ”Ğ¼Ğ¾ Ğ¿ĞµÑ€ĞµÑ‚ÑĞ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñƒ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ– Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ
Â  Â  dragging=true;
Â  Â  dragStartX=e.offsetX-layers[activeLayer].x;
Â  Â  dragStartY=e.offsetY-layers[activeLayer].y;
});
canvas.addEventListener('mousemove',e=>{
Â  Â  if(!dragging || previewMode || !activeLayer) return; // Ğ’Ñ–Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ”Ğ¼Ğ¾ Ğ¿ĞµÑ€ĞµÑ‚ÑĞ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñƒ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ– Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ
Â  Â  layers[activeLayer].x=e.offsetX-dragStartX;
Â  Â  layers[activeLayer].y=e.offsetY-dragStartY;
Â  Â  drawAll();
});
function stopDrag(){
Â  Â  if(dragging){ dragging=false; pushHistory(); }
}
canvas.addEventListener('mouseup',stopDrag);
canvas.addEventListener('mouseleave',stopDrag);
canvas.addEventListener('touchstart',e=>{
Â  Â  if(previewMode || !activeLayer) return; // Ğ’Ñ–Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ”Ğ¼Ğ¾ Ğ¿ĞµÑ€ĞµÑ‚ÑĞ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñƒ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ– Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ
Â  Â  const t=e.touches[0],rect=canvas.getBoundingClientRect();
Â  Â  dragging=true;
Â  Â  dragStartX=(t.clientX-rect.left) * (canvas.width/rect.width) - layers[activeLayer].x;
Â  Â  dragStartY=(t.clientY-rect.top) * (canvas.height/rect.height) - layers[activeLayer].y;
Â  Â  e.preventDefault();
});
canvas.addEventListener('touchmove',e=>{
Â  Â  if(!dragging || previewMode || !activeLayer) return; // Ğ’Ñ–Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ”Ğ¼Ğ¾ Ğ¿ĞµÑ€ĞµÑ‚ÑĞ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñƒ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ– Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ
Â  Â  const t=e.touches[0],rect=canvas.getBoundingClientRect();
Â  Â  layers[activeLayer].x=(t.clientX-rect.left) * (canvas.width/rect.width) - dragStartX;
Â  Â  layers[activeLayer].y=(t.clientY-rect.top) * (canvas.height/rect.height) - dragStartY;
Â  Â  drawAll();
Â  Â  e.preventDefault();
});
canvas.addEventListener('touchend',stopDrag);

// --- Undo / Preview / Download ---
undoBtn.addEventListener('click',()=>{
Â  Â  if(history.length<=1) return;
Â  Â  history.pop();
Â  Â  applySnapshot(history[history.length-1]);
});
previewBtn.addEventListener('click',()=>{
Â  Â  previewMode=true;
Â  Â  scaleSlider.disabled = true;
Â  Â  scaleSlider.classList.add('disabled');
Â  Â  pushHistory();
Â  Â  toggleButtons();
Â  Â  drawAll();
});
downloadBtn.addEventListener('click',()=>{
Â  Â  // Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ±ĞµĞ·Ğ¿Ğ¾ÑĞµÑ€ĞµĞ´Ğ½ÑŒĞ¾ Ğ· Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ½Ğ²Ğ°ÑÑƒ
Â  Â  const link=document.createElement('a');
Â  Â  link.download='collage.jpg';
Â  Â  link.href=canvas.toDataURL('image/jpeg');
Â  Â  link.click();
});
document.getElementById('updateBtn').addEventListener('click', function () {
Â  Â  const confirmUpdate = confirm("Ğ’Ğ¸ Ğ²Ğ¿ĞµĞ²Ğ½ĞµĞ½Ñ–, Ñ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ¾Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºÑƒ? Ğ£ÑÑ– Ğ½ĞµĞ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ñ– Ğ·Ğ¼Ñ–Ğ½Ğ¸ Ğ±ÑƒĞ´Ğµ Ğ²Ñ‚Ñ€Ğ°Ñ‡ĞµĞ½Ğ¾.");
Â  Â  if (confirmUpdate) {
Â  Â  Â  Â  const url = window.location.href.split('?')[0];
Â  Â  Â  Â  window.location.href = url + '?_=' + new Date().getTime();
Â  Â  }
});

// Ğ’Ğ¸Ğ¼ĞºĞ½ĞµĞ½Ğ½Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ñ‚Ğ° ĞºĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ğ½Ğ½Ñ
function disableContextMenu() {
Â  Â  return false;
}
document.oncontextmenu = disableContextMenu;
document.onselectstart = disableContextMenu;
document.ondragstart = disableContextMenu;

// Ğ†Ğ½Ñ–Ñ†Ñ–Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ
template.onload = () => { drawAll(); };
renderThumbnails();
renderVows();
applySnapshot(history[0] || makeSnapshot());
</script>
</body>
</html>
